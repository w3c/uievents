<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>UI Events Algorithms</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in §N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .assertion  for assertions                    (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/******************************************************************************/
/*                                   Body                                     */
/******************************************************************************/

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;               /* limit line length to 50em for readability   */
		margin: 0 auto;                /* center text within page                     */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag     */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		/* Colors */
		color: black;
		background: white top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		color: white;
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		border-color: #c00;
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 2;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
			color: black;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			background: white;
			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;
			background: white;
		}
		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		#toc-nav > a:hover,
		#toc-nav > a:focus {
			background: #f8f8f8;
		}
		#toc-nav > a:not(:hover):not(:focus) {
			color: #707070;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}

		#toc-toggle-inline {
			vertical-align: 0.05em;
			font-size: 80%;
			color: gray;
			color: hsla(203,20%,40%,.7);
			border-style: none;
			background: transparent;
			position: relative;
		}
		#toc-toggle-inline:hover:not(:active),
		#toc-toggle-inline:focus:not(:active) {
			text-shadow: 1px 1px silver;
			top: -1px;
			left: -1px;
		}

		#toc-nav :active {
			color: #C00;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			background: inherit;
			background-color: #f7f8f9;
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;    /* Inherit the font family. */
		line-height: 1.2;        /* Keep wrapped headings compact */
		hyphens: manual;         /* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		background: transparent;
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#subtitle {
		/* #subtitle is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	 border-left: 0.5em solid #DEF;
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	  padding: .5em;
	  border: thin solid #ddd; border-radius: .5em;
	  margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	  margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	  margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	 margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	 margin-left: -2em;
	}
	dl.switch {
	 padding-left: 2em;
	}
	dl.switch > dt {
	 text-indent: -1.5em;
	 margin-top: 1em;
	}
	dl.switch > dt + dt {
	 margin-top: 0;
	}
	dl.switch > dt::before {
	 content: '\21AA';
	 padding: 0 0.5em 0 0;
	 display: inline-block;
	 width: 1em;
	 text-align: right;
	 line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: medium;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del { color: red;  text-decoration: line-through; }
	ins { color: #080; text-decoration: underline;    }

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		page-break-inside: avoid;
		hyphens: none;
		text-transform: none;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

  /* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		text-decoration: none;
		border-bottom: 1px solid #707070;
		/* Need a bit of extending for it to look okay */
		padding: 0 1px 0;
		margin: 0 -1px 0;
	}
	a:visited {
		border-bottom-color: #BBB;
	}

	/* Use distinguishing colors when user is interacting with the link */
	a[href]:focus,
	a[href]:hover {
		background: #f8f8f8;
		background: rgba(75%, 75%, 75%, .25);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	a[href]:active {
		color: #C00;
		border-color: #C00;
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	/* For autogen numbers, add
	   .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,    .sidefigure img,    figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote {
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	.issue,
	.note,
	.example,
	.advisement,
	.assertion,
	blockquote {
		margin: 1em auto;
	}
	.note  > p:first-child,
	.issue > p:first-child,
	blockquote > :first-child {
		margin-top: 0;
	}
	blockquote > :last-child {
		margin-bottom: 0;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #E05252;
		background: #FBE9E9;
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		text-transform: uppercase;
		color: #AE1E1E;
		padding-right: 1em;
		text-transform: uppercase;
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	   or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #E0CB52;
		background: #FCFAEE;
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		text-transform: uppercase;
		color: #827017;
		min-width: 7.5em;
		display: block;
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	   or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52E052;
		background: #E9FBE9;
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary::before,
	details.note > summary > .marker {
		text-transform: uppercase;
		display: block;
		color: hsl(120, 70%, 30%);
	}
	/* Add .note::before { content: "Note"; } for autogen label,
	   or use class="marker" to mark up the label in source. */

	details.note > summary {
		display: block;
		color: hsl(120, 70%, 30%);
	}
	details.note[open] > summary {
		border-bottom: 1px silver solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		background: #EEE;
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-style: none solid;
		background: #FFEECC;
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement > .marker {
		color: #B35F00;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: #fdd;
		color: red;
		font-weight: bold;
		padding: .75em 1em;
		border: thick red;
		border-style: solid;
		border-radius: 1em;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 1em;
		right: 1em;
		bottom: 1em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #DEF;
		margin: 1.2em 0;
		border-left: 0.5em solid #8CCBF2;
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def           td.footnote {
		padding-top: 0.6em;
	}
	table.def           td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		 <table class="data"> highlights structural relationships in a table
		 when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		 Use class="complex data" for particularly complicated tables --
		 (This will draw more lines: busier, but clearer.)

		 Use class="long" on table cells with paragraph-like contents
		 (This will adjust text alignment accordingly.)
		 Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
	 vertical-align: baseline;
	 text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding-top: 0.1rem;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Reverse color scheme */
		color: black;
		border-color: #3980B5;
		border-bottom-width: 3px !important;
		margin-bottom: 0px !important;
	}
	.toc a:visited {
		border-color: #054572;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
		line-height: 1.1rem; /* consistent spacing */
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li             { font-weight: bold;   }
	.toc > li li          { font-weight: normal; }
	.toc > li li li       { font-size:   95%;    }
	.toc > li li li li    { font-size:   90%;    }
	.toc > li li li li .secno { font-size: 85%; }
	.toc > li li li li li { font-size:   85%;    }
	.toc > li li li li li .secno { font-size: 100%; }

	/* @supports not (display:grid) { */
		.toc > li             { margin: 1.5rem 0;    }
		.toc > li li          { margin: 0.3rem 0;    }
		.toc > li li li       { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}

		.toc li {
			clear: both;
		}

		:not(li) > .toc              { margin-left:  5rem; }
		.toc .secno                  { margin-left: -5rem; }
		.toc > li li li .secno       { margin-left: -7rem; }
		.toc > li li li li .secno    { margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc              { margin-left:  4rem; }
			.toc .secno                  { margin-left: -4rem; }
			.toc > li li li              { margin-left:  1rem; }
			.toc > li li li .secno       { margin-left: -5rem; }
			.toc > li li li li .secno    { margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			   comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
		}
		#toc .content:hover {
			background: rgba(75%, 75%, 75%, .25);
			border-bottom: 3px solid #054572;
			margin-bottom: -3px;
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index       { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li    { margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em }
	ul.index dl    { margin-top: 0; }
	ul.index dt    { margin: .2em 0 .2em 20px;}
	ul.index dd    { margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		background: #f7f8f9;
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}

/******************************************************************************/
/*                                    Legacy                                  */
/******************************************************************************/

	/* This rule is inherited from past style sheets. No idea what it's for. */
	.hide { display: none }



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good table positioning:
		   "content column" is 50ems wide at max; less on smaller screens.
		   Extra space (after ToC + content) is empty on the right.

		   1. When table < content column, centers table in column.
		   2. When content < table < available, left-aligns.
		   3. When table > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			 * http://lea.verou.me/2012/04/background-attachment-local/
			 *
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
			            top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
			            top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
			            white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version 6cf40e14, updated Fri Aug 14 17:42:41 2020 -0700" name="generator">
  <meta content="770724ae166d3d9d2e269a470eb5d156a999be71" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: #DDDDDD;
    color: black;
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: black; }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1>UI Events Algorithms</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">A Collection of Interesting Ideas, <time class="dt-updated" datetime="2020-08-25">25 August 2020</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/w3c/uievents/issues/">GitHub</a>
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:garykac@google.com">Gary Kacmarcik</a> (<span class="p-org org">Google</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://creativecommons.org/publicdomain/zero/1.0/" rel="license"><img alt="CC0" src="https://licensebuttons.net/p/zero/1.0/80x15.png"></a> To the extent possible under law, the editors have waived all copyright
and related or neighboring rights to this work.
In addition, as of 25 August 2020,
the editors have made this specification available under the <a href="http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from another specification document.  If so, those parts are instead covered by the license of that specification document. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This document attempts to describe, in an algorithmic manner, how UIEvents

        should be handled by User Agents. Because this functionality has been shipping
        in UAs for many years, the primary goal is to document the existing behaviors
        and identify areas where implementations disagree. The intent is to fold this
        information into the main UIEvents spec (and other specs) once there is
        consensus that this process described here is adequate.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Why?</span></a>
    <li>
     <a href="#native-os"><span class="secno">2</span> <span class="content">Native OS Requirements</span></a>
     <ol class="toc">
      <li><a href="#req-mouse"><span class="secno">2.1</span> <span class="content">MouseEvent Requirements</span></a>
      <li><a href="#req-keyboard"><span class="secno">2.2</span> <span class="content">KeyboardEvent Requirements</span></a>
      <li><a href="#req-ime"><span class="secno">2.3</span> <span class="content">IME Requirements</span></a>
      <li>
       <a href="#native-entry-points"><span class="secno">2.4</span> <span class="content">Native Entry Points</span></a>
       <ol class="toc">
        <li><a href="#native-mouse"><span class="secno">2.4.1</span> <span class="content">Mouse</span></a>
        <li><a href="#native-keyboard"><span class="secno">2.4.2</span> <span class="content">Keyboard</span></a>
        <li><a href="#native-clipboard"><span class="secno">2.4.3</span> <span class="content">Clipboard</span></a>
       </ol>
     </ol>
    <li>
     <a href="#event"><span class="secno">3</span> <span class="content">Event</span></a>
     <ol class="toc">
      <li><a href="#event-interface"><span class="secno">3.1</span> <span class="content">Event Interface</span></a>
      <li><a href="#initialize an event"><span class="secno">3.2</span> <span class="content"><span>initialize an Event</span></span></a>
     </ol>
    <li>
     <a href="#ui event"><span class="secno">4</span> <span class="content">UI Event</span></a>
     <ol class="toc">
      <li><a href="#uievent-interface"><span class="secno">4.1</span> <span class="content">UIEvent Interface</span></a>
      <li><a href="#initialize a uievent"><span class="secno">4.2</span> <span class="content"><span>initialize a UIEvent</span></span></a>
     </ol>
    <li>
     <a href="#mouse event"><span class="secno">5</span> <span class="content">Mouse Event</span></a>
     <ol class="toc">
      <li><a href="#mouseevent-interface"><span class="secno">5.1</span> <span class="content">MouseEvent Interface</span></a>
      <li>
       <a href="#mouseevent-global-state"><span class="secno">5.2</span> <span class="content">Global State for MouseEvent</span></a>
       <ol class="toc">
        <li><a href="#mouseevent-global-ua"><span class="secno">5.2.1</span> <span class="content">User Agent-Level State</span></a>
        <li><a href="#mouseevent-global-window"><span class="secno">5.2.2</span> <span class="content">Window-Level State</span></a>
       </ol>
      <li><a href="#initialize a mouseevent"><span class="secno">5.3</span> <span class="content"><span>initialize a MouseEvent</span></span></a>
      <li><a href="#create a mouseevent"><span class="secno">5.4</span> <span class="content"><span>create a MouseEvent</span></span></a>
      <li><a href="#calculate mouseevent button attribute"><span class="secno">5.5</span> <span class="content"><span>calculate MouseEvent button attribute</span></span></a>
      <li><a href="#set mouseevent attributes from native"><span class="secno">5.6</span> <span class="content"><span>set MouseEvent attributes from native</span></span></a>
      <li><a href="#handle native mouse down"><span class="secno">5.7</span> <span class="content"><span>handle native mouse down</span></span></a>
      <li><a href="#handle native mouse up"><span class="secno">5.8</span> <span class="content"><span>handle native mouse up</span></span></a>
      <li><a href="#handle native mouse click"><span class="secno">5.9</span> <span class="content"><span>handle native mouse click</span></span></a>
      <li><a href="#handle native mouse double click"><span class="secno">5.10</span> <span class="content"><span>handle native mouse double click</span></span></a>
      <li><a href="#handle native mouse move"><span class="secno">5.11</span> <span class="content"><span>handle native mouse move</span></span></a>
     </ol>
    <li>
     <a href="#keyboard event"><span class="secno">6</span> <span class="content">Keyboard Event</span></a>
     <ol class="toc">
      <li><a href="#keyboardevent-interface"><span class="secno">6.1</span> <span class="content">KeyboardEvent Interface</span></a>
      <li>
       <a href="#keyboardevent-global-state"><span class="secno">6.2</span> <span class="content">Global State for KeyboardEvent</span></a>
       <ol class="toc">
        <li><a href="#keyboardevent-global-ua"><span class="secno">6.2.1</span> <span class="content">User Agent-Level State</span></a>
        <li><a href="#keyboardevent-global-window"><span class="secno">6.2.2</span> <span class="content">Window-Level State</span></a>
       </ol>
      <li><a href="#initialize a keyboardevent"><span class="secno">6.3</span> <span class="content"><span>initialize a KeyboardEvent</span></span></a>
      <li><a href="#create a keyboardevent"><span class="secno">6.4</span> <span class="content"><span>create a KeyboardEvent</span></span></a>
      <li><a href="#set event modifiers"><span class="secno">6.5</span> <span class="content"><span>set event modifiers</span></span></a>
      <li><a href="#set keyboardevent attributes"><span class="secno">6.6</span> <span class="content"><span>set KeyboardEvent attributes</span></span></a>
      <li><a href="#calculate key locationinitialize a keyboardevent"><span class="secno">6.7</span> <span class="content"><span>calculate key location</span></span></a>
      <li><a href="#get modifier state"><span class="secno">6.8</span> <span class="content"><span>get modifier state</span></span></a>
      <li><a href="#handle pre browser key"><span class="secno">6.9</span> <span class="content"><span>handle pre browser key</span></span></a>
      <li><a href="#handle post browser key"><span class="secno">6.10</span> <span class="content"><span>handle post browser key</span></span></a>
      <li><a href="#handle native key down"><span class="secno">6.11</span> <span class="content"><span>handle native key down</span></span></a>
      <li><a href="#handle native key up"><span class="secno">6.12</span> <span class="content"><span>handle native key up</span></span></a>
      <li><a href="#handle native key press"><span class="secno">6.13</span> <span class="content"><span>handle native key press</span></span></a>
     </ol>
    <li>
     <a href="#input event"><span class="secno">7</span> <span class="content">Input Event</span></a>
     <ol class="toc">
      <li><a href="#initialize an Inputevent"><span class="secno">7.1</span> <span class="content"><span>initialize an InputEvent</span></span></a>
      <li><a href="#create an inputevent"><span class="secno">7.2</span> <span class="content"><span>create an InputEvent</span></span></a>
      <li><a href="#fire key input events"><span class="secno">7.3</span> <span class="content"><span>fire key input events</span></span></a>
      <li><a href="#fire an inputevent"><span class="secno">7.4</span> <span class="content"><span>fire an InputEvent</span></span></a>
     </ol>
    <li>
     <a href="#composition event"><span class="secno">8</span> <span class="content">Composition Event</span></a>
     <ol class="toc">
      <li>
       <a href="#compositionevent-global-state"><span class="secno">8.1</span> <span class="content">Global State for CompositionEvent</span></a>
       <ol class="toc">
        <li><a href="#compositionevent-global-window"><span class="secno">8.1.1</span> <span class="content">Window-Level State</span></a>
       </ol>
      <li><a href="#initialize a compositionevent"><span class="secno">8.2</span> <span class="content"><span>initialize a CompositionEvent</span></span></a>
      <li><a href="#create a compositionevent"><span class="secno">8.3</span> <span class="content"><span>create a CompositionEvent</span></span></a>
      <li><a href="#fire a compositionevent"><span class="secno">8.4</span> <span class="content"><span>fire a CompositionEvent</span></span></a>
      <li><a href="#enter composition mode"><span class="secno">8.5</span> <span class="content"><span>enter composition mode</span></span></a>
      <li><a href="#exit composition mode"><span class="secno">8.6</span> <span class="content"><span>exit composition mode</span></span></a>
      <li><a href="#handle composition key"><span class="secno">8.7</span> <span class="content"><span>handle composition key</span></span></a>
      <li><a href="#begin composition"><span class="secno">8.8</span> <span class="content"><span>begin composition</span></span></a>
      <li><a href="#end composition"><span class="secno">8.9</span> <span class="content"><span>end composition</span></span></a>
      <li><a href="#pointerevent-global-state"><span class="secno">8.10</span> <span class="content">Global State for PointerEvent</span></a>
     </ol>
    <li>
     <a href="#pointer event"><span class="secno">9</span> <span class="content">Pointer Event</span></a>
     <ol class="toc">
      <li><a href="#initialize a pointerevent"><span class="secno">9.1</span> <span class="content"><span>initialize a PointerEvent</span></span></a>
      <li><a href="#create pointerevent from mouseevent"><span class="secno">9.2</span> <span class="content"><span>create PointerEvent from MouseEvent</span></span></a>
      <li><a href="#maybe send pointerout event"><span class="secno">9.3</span> <span class="content"><span>maybe send pointerout event</span></span></a>
      <li><a href="#maybe send pointerleave event"><span class="secno">9.4</span> <span class="content"><span>maybe send pointerleave event</span></span></a>
      <li><a href="#maybe send pointerover event"><span class="secno">9.5</span> <span class="content"><span>maybe send pointerover event</span></span></a>
      <li><a href="#maybe send pointerenter event"><span class="secno">9.6</span> <span class="content"><span>maybe send pointerenter event</span></span></a>
      <li><a href="#maybe send pointermove event"><span class="secno">9.7</span> <span class="content"><span>maybe send pointermove event</span></span></a>
      <li><a href="#maybe send pointerdown event"><span class="secno">9.8</span> <span class="content"><span>maybe send pointerdown event</span></span></a>
      <li><a href="#maybe send pointerup event"><span class="secno">9.9</span> <span class="content"><span>maybe send pointerup event</span></span></a>
     </ol>
    <li>
     <a href="#pointer lock"><span class="secno">10</span> <span class="content">Pointer Lock</span></a>
     <ol class="toc">
      <li><a href="#pointerlock-interface"><span class="secno">10.1</span> <span class="content">MouseEvent Interface Extension</span></a>
      <li>
       <a href="#pointer-lock-global-state"><span class="secno">10.2</span> <span class="content">Global State for PointerLock</span></a>
       <ol class="toc">
        <li><a href="#pointer-lock-global-window"><span class="secno">10.2.1</span> <span class="content">Window-Level State</span></a>
       </ol>
      <li><a href="#initialize pointerlock attributes for mouseevent"><span class="secno">10.3</span> <span class="content"><span>initialize PointerLock attributes for MouseEvent</span></span></a>
      <li><a href="#set pointerlock attributes for mousemove"><span class="secno">10.4</span> <span class="content"><span>set PointerLock attributes for mousemove</span></span></a>
     </ol>
    <li>
     <a href="#keyboard lock"><span class="secno">11</span> <span class="content">Keyboard Lock</span></a>
     <ol class="toc">
      <li>
       <a href="#keyboard-lock-global-state"><span class="secno">11.1</span> <span class="content">Global State for Keyboard Lock</span></a>
       <ol class="toc">
        <li><a href="#keyboard-lock-global-ua"><span class="secno">11.1.1</span> <span class="content">User Agent-Level State</span></a>
        <li><a href="#keyboard-lock-global-window"><span class="secno">11.1.2</span> <span class="content">Window-Level State</span></a>
       </ol>
      <li><a href="#keyboard lock is enabled"><span class="secno">11.2</span> <span class="content"><span>Keyboard Lock is enabled</span></span></a>
     </ol>
    <li>
     <a href="#core dom"><span class="secno">12</span> <span class="content">Core DOM</span></a>
     <ol class="toc">
      <li><a href="#hit test"><span class="secno">12.1</span> <span class="content"><span>hit test</span></span></a>
      <li><a href="#calculate dom path"><span class="secno">12.2</span> <span class="content"><span>calculate DOM path</span></span></a>
     </ol>
    <li>
     <a href="#cssom"><span class="secno">13</span> <span class="content">CSSOM</span></a>
     <ol class="toc">
      <li><a href="#initialize cssom attributes for mouseevent"><span class="secno">13.1</span> <span class="content"><span>initialize CSSOM attributes for MouseEvent</span></span></a>
     </ol>
    <li>
     <a href="#clipboard"><span class="secno">14</span> <span class="content">Clipboard</span></a>
     <ol class="toc">
      <li><a href="#handle native cut"><span class="secno">14.1</span> <span class="content"><span>handle native cut</span></span></a>
      <li><a href="#handle native copy"><span class="secno">14.2</span> <span class="content"><span>handle native copy</span></span></a>
      <li><a href="#handle native paste"><span class="secno">14.3</span> <span class="content"><span>handle native paste</span></span></a>
     </ol>
    <li><a href="#acknowledgementsclipboard"><span class="secno">15</span> <span class="content">Acknowledgements</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <section>
    <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Why?</span><a class="self-link" href="#intro"></a></h2>
    <p>The description of events in the current UIEvents spec is woefully underspecified.
This has led to different User Agents (UAs) implementing the same feature with
different behaviors.</p>
    <p>The intent with this document is to:</p>
    <ul>
     <li data-md>
      <p>Describe the current behaviors that are shared by existing UAs</p>
     <li data-md>
      <p>Identify behaviors where they differ</p>
     <li data-md>
      <p>Initiate discussions to resolve the differences</p>
    </ul>
    <p>Part of this process will necessarily require that we describe processes that
rightfully belong in other specifications (e.g., Pointer Events or Input Events).
The intent is to eventually move those portions into their appropriate home,
but they are kept here while drafting this document to make it easier to discuss.</p>
   </section>
   <section>
    <h2 class="heading settled" data-level="2" id="native-os"><span class="secno">2. </span><span class="content">Native OS Requirements</span><a class="self-link" href="#native-os"></a></h2>
    <p>The following is the set of assumptions that this specification makes about the
underlying native operating system. It is expected that the native OS will
provide these basic services for the UA.</p>
    <p>In the event that the native OS does not provide these services, then the
UA will need to implement them.</p>
    <h3 class="heading settled" data-level="2.1" id="req-mouse"><span class="secno">2.1. </span><span class="content">MouseEvent Requirements</span><a class="self-link" href="#req-mouse"></a></h3>
    <p>The native OS platform will provide:</p>
    <ul>
     <li data-md>
      <p>An event when the mouse is moved</p>
     <li data-md>
      <p>An event when a mouse button is pressed</p>
     <li data-md>
      <p>An event when a mouse button is released</p>
     <li data-md>
      <p>A way to identify when a mouse button press should be interpreted as a "click"</p>
      <ul>
       <li data-md>
        <p>For example, as a flag or as a separate event</p>
       <li data-md>
        <p>If a separate "click" event is fired, then the native OS will fire it
immediately after the corresponding "mouse up" event, with no
intervening mouse-related events</p>
      </ul>
     <li data-md>
      <p>A way to identify when a mouse click is a "double click"</p>
    </ul>
    <p>For these events, the OS will be able to provide the following info:</p>
    <ul>
     <li data-md>
      <p>The x,y mouse coordinates relative to the native OS desktop</p>
     <li data-md>
      <p>The x,y mouse coordinates relative to the UA’s window viewport</p>
     <li data-md>
      <p>Which keyboard modifiers are currently being held</p>
    </ul>
    <h3 class="heading settled" data-level="2.2" id="req-keyboard"><span class="secno">2.2. </span><span class="content">KeyboardEvent Requirements</span><a class="self-link" href="#req-keyboard"></a></h3>
    <p>The native OS platform will provide:</p>
    <ul>
     <li data-md>
      <p>An event when a key is pressed</p>
      <p class="note" role="note"><span>Note:</span> On Windows: WM_KEYDOWN, WM_SYSKEYDOWN</p>
      <p class="note" role="note"><span>Note:</span> On macOS: NSKeyDown, NSFlagsChanged (for modifiers without other keys)</p>
     <li data-md>
      <p>An event when a key is released</p>
      <p class="note" role="note"><span>Note:</span> On Windows: WM_KEYUP, WM_SYSKEYUP</p>
      <p class="note" role="note"><span>Note:</span> On macOS: NSKeyUp, NSFlagsChanged (for modifiers without other keys)</p>
     <li data-md>
      <p>An event when a character should be generated as a result of a keypress</p>
      <ul>
       <li data-md>
        <p>This may be a separate event, or it may be combined with the keydown event</p>
        <ul>
         <li data-md>
          <p>If a separate event, then there are no intervening key events between keydown and char</p>
        </ul>
      </ul>
      <p class="note" role="note"><span>Note:</span> On Windows: WM_CHAR, WM_SYSCHAR</p>
      <p class="note" role="note"><span>Note:</span> On macOS: Combined with keydown</p>
     <li data-md>
      <p>An event when text should be inserted</p>
      <ul>
       <li data-md>
        <p>These are commonly used for alternate input devices like chordal keyboards or speech input</p>
       <li data-md>
        <p>This may be the same event as for when a key is pressed</p>
      </ul>
      <p class="note" role="note"><span>Note:</span> On Windows: WM_CHAR (without associated keydown/keyup)</p>
      <p class="note" role="note"><span>Note:</span> On macOS: NSTextInputClient with insertText</p>
     <li data-md>
      <p>A way to identify key events that are "repeat"s from the key being held down</p>
      <ul>
       <li data-md>
        <p>The platform will maintain a key repeat threshold</p>
      </ul>
     <li data-md>
      <p>A way to identify the modifier keys that are held in combination with a key press</p>
      <ul>
       <li data-md>
        <p>Either via flags in the messages, or via a separate call</p>
      </ul>
      <p class="note" role="note"><span>Note:</span> On Windows: included with WM_ messages</p>
      <p class="note" role="note"><span>Note:</span> On macOS: included with NSKey messages and NSFlagChanged</p>
      <p class="note" role="note"><span>Note:</span> On Linux (GTK): not provided with messages. need to request separately</p>
    </ul>
    <h3 class="heading settled" data-level="2.3" id="req-ime"><span class="secno">2.3. </span><span class="content">IME Requirements</span><a class="self-link" href="#req-ime"></a></h3>
    <p class="issue" id="issue-39f24517"><a class="self-link" href="#issue-39f24517"></a> IMEs differ wildly on different platforms, and often have different capabilities
(such as whether or not they can be "canceled") even on the same platform.
What is the common set of requirements that we can rely on?</p>
    <p class="issue" id="issue-dba77cfe"><a class="self-link" href="#issue-dba77cfe"></a> For example, on Windows, Win+'.' opens an emoji window that will generate
composition events. But there is not indication from the OS that composition
is about to take place. A similar problem exists with "shape writing" using the
virtual keyboard.</p>
    <h3 class="heading settled" data-level="2.4" id="native-entry-points"><span class="secno">2.4. </span><span class="content">Native Entry Points</span><a class="self-link" href="#native-entry-points"></a></h3>
    <h4 class="heading settled" data-level="2.4.1" id="native-mouse"><span class="secno">2.4.1. </span><span class="content">Mouse</span><a class="self-link" href="#native-mouse"></a></h4>
    <ul>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-mouse-down" id="ref-for-handle-native-mouse-down">handle native mouse down</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-mouse-up" id="ref-for-handle-native-mouse-up">handle native mouse up</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-mouse-click" id="ref-for-handle-native-mouse-click">handle native mouse click</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-mouse-double-click" id="ref-for-handle-native-mouse-double-click">handle native mouse double click</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-mouse-move" id="ref-for-handle-native-mouse-move">handle native mouse move</a></p>
    </ul>
    <h4 class="heading settled" data-level="2.4.2" id="native-keyboard"><span class="secno">2.4.2. </span><span class="content">Keyboard</span><a class="self-link" href="#native-keyboard"></a></h4>
    <ul>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-key-down" id="ref-for-handle-native-key-down">handle native key down</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-key-press" id="ref-for-handle-native-key-press">handle native key press</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-key-up" id="ref-for-handle-native-key-up">handle native key up</a></p>
    </ul>
    <h4 class="heading settled" data-level="2.4.3" id="native-clipboard"><span class="secno">2.4.3. </span><span class="content">Clipboard</span><a class="self-link" href="#native-clipboard"></a></h4>
    <ul>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-cut" id="ref-for-handle-native-cut">handle native cut</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-copy" id="ref-for-handle-native-copy">handle native copy</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="#handle-native-paste" id="ref-for-handle-native-paste">handle native paste</a></p>
    </ul>
   </section>
   <section>
    <h2 class="heading settled" data-level="3" id="event"><span class="secno">3. </span><span class="content">Event</span><a class="self-link" href="#event"></a></h2>
    <p class="issue" id="issue-a52634a8"><a class="self-link" href="#issue-a52634a8"></a> Move to/merge with <a data-link-type="biblio" href="#biblio-dom">[DOM]</a> spec <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event">Event</a></code> interface.</p>
    <h3 class="heading settled" data-level="3.1" id="event-interface"><span class="secno">3.1. </span><span class="content">Event Interface</span><a class="self-link" href="#event-interface"></a></h3>
    <p>A <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event①">Event</a></code> has the following additional internal state:</p>
    <dl>
     <li>
      <dfn class="dfn-paneled" data-dfn-for="UIEvent" data-dfn-type="dfn" data-noexport id="uievent-due-to-user-interaction-flag">due to user interaction flag</dfn> 
      <p class="issue" id="issue-8b668288"><a class="self-link" href="#issue-8b668288"></a> This is a proposal.
    See <a href="https://github.com/w3c/uievents/issues/270">uievents/270</a></p>
    </dl>
    <div class="algorithm" data-algorithm="initialize-an-event">
     <h3 class="heading settled" data-level="3.2" id="initialize an event"><span class="secno">3.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-an-event">initialize an Event</dfn></span><a class="self-link" href="#initialize%20an%20event"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event②">Event</a></code> to initialize</p>
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p>For reference, see <a href="https://dom.spec.whatwg.org/#concept-event-initialize">initialize an event</a>, <a href="https://dom.spec.whatwg.org/#stop-propagation-flag" id="termref-for-">list of event flags</a>.</p>
     <ol>
      <li data-md>
       <p>Initialize the following public attributes</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type">type</a></code> = <var>eventType</var></p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target">target</a></code> = <var>eventTarget</var></p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-currenttarget" id="ref-for-dom-event-currenttarget">currentTarget</a></code> = null (This will be set appropriately during dispatch)</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-eventphase" id="ref-for-dom-event-eventphase">eventPhase</a></code> = <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-none" id="ref-for-dom-event-none">NONE</a></code> (This will be set appropriately during dispatch)</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-bubbles" id="ref-for-dom-event-bubbles">bubbles</a></code> = true</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-cancelable" id="ref-for-dom-event-cancelable">cancelable</a></code> = true</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-defaultprevented" id="ref-for-dom-event-defaultprevented">defaultPrevented</a></code> = false</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-composed" id="ref-for-dom-event-composed">composed</a></code> = false  // See COMPAT note for mouseenter and mouseleave</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-istrusted" id="ref-for-dom-event-istrusted">isTrusted</a></code> = false</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-timestamp" id="ref-for-dom-event-timestamp">timeStamp</a></code> = Number of milliseconds relative to the time origin</p>
       </ol>
      <li data-md>
       <p>Initialize the following historical attributes</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.srcElement = <var>eventTarget</var></p>
        <li data-md>
         <p>Set <var>event</var>.cancelBubble = alias for stopPropagation</p>
        <li data-md>
         <p>Set <var>event</var>.returnValue = alias for !canceled_flag</p>
       </ol>
      <li data-md>
       <p>Initialize the following internal state</p>
       <ol>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#stop-propagation-flag" id="ref-for-stop-propagation-flag">stop propagation flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#stop-immediate-propagation-flag" id="ref-for-stop-immediate-propagation-flag">stop immediate propagation flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#canceled-flag" id="ref-for-canceled-flag">canceled flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#in-passive-listener-flag" id="ref-for-in-passive-listener-flag">in passive listener flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#composed-flag" id="ref-for-composed-flag">composed flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#initialized-flag" id="ref-for-initialized-flag">initialized flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#dispatch-flag" id="ref-for-dispatch-flag">dispatch flag</a></p>
       </ol>
      <li data-md>
       <p>Initialize the following proposed internal state</p>
       <ol>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="#uievent-due-to-user-interaction-flag" id="ref-for-uievent-due-to-user-interaction-flag">due to user interaction flag</a></p>
       </ol>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="4" id="ui event"><span class="secno">4. </span><span class="content">UI Event</span><a class="self-link" href="#ui%20event"></a></h2>
    <h3 class="heading settled" data-level="4.1" id="uievent-interface"><span class="secno">4.1. </span><span class="content">UIEvent Interface</span><a class="self-link" href="#uievent-interface"></a></h3>
    <p>A <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#uievent" id="ref-for-uievent">UIEvent</a></code> has the following:</p>
    <dl>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="UIEvent" data-dfn-type="attribute" data-export id="dom-uievent-view"><code>view</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="UIEvent" data-dfn-type="attribute" data-export id="dom-uievent-detail"><code>detail</code></dfn>
    </dl>
    <p>Along with the following historical attribute:</p>
    <dl>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-which"><code>which</code></dfn>
    </dl>
    <div class="algorithm" data-algorithm="initialize-a-uievent">
     <h3 class="heading settled" data-level="4.2" id="initialize a uievent"><span class="secno">4.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-a-uievent">initialize a UIEvent</dfn></span><a class="self-link" href="#initialize%20a%20uievent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#uievent" id="ref-for-uievent①">UIEvent</a></code> to initialize</p>
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget①">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-an-event" id="ref-for-initialize-an-event">Initialize an Event</a> with <var>event</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Initialize the following public attributes</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-uievent-view" id="ref-for-dom-uievent-view">view</a></code> = the <var>eventTarget</var>’s <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-node-document" id="ref-for-concept-node-document">node document</a>’s <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/window-object.html#window" id="ref-for-window">Window</a></code> object</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-uievent-detail" id="ref-for-dom-uievent-detail">detail</a></code> = 0</p>
       </ol>
      <li data-md>
       <p>Initialize the following historical attributes</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-which" id="ref-for-dom-keyboardevent-which">which</a></code> = 0  (used by both <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent">MouseEvent</a></code> and <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#keyboardevent" id="ref-for-keyboardevent">KeyboardEvent</a></code>)</p>
       </ol>
      <li data-md>
       <p>If this event is the result of user interaction, then</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>’s <a data-link-type="dfn" href="#uievent-due-to-user-interaction-flag" id="ref-for-uievent-due-to-user-interaction-flag①">due to user interaction flag</a></p>
         <p class="note" role="note"><span>Note:</span> See <a href="https://github.com/w3c/uievents/issues/270">uievents/270</a></p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-istrusted" id="ref-for-dom-event-istrusted①">isTrusted</a></code> = false</p>
       </ol>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="5" id="mouse event"><span class="secno">5. </span><span class="content">Mouse Event</span><a class="self-link" href="#mouse%20event"></a></h2>
    <h3 class="heading settled" data-level="5.1" id="mouseevent-interface"><span class="secno">5.1. </span><span class="content">MouseEvent Interface</span><a class="self-link" href="#mouseevent-interface"></a></h3>
    <p>A <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①">MouseEvent</a></code> has the following:</p>
    <dl>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-screenx"><code>screenX</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-screeny"><code>screenY</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-clientx"><code>clientX</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-clienty"><code>clientY</code></dfn>
     <li><dfn class="idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-ctrlkey"><code>ctrlKey</code><a class="self-link" href="#dom-mouseevent-ctrlkey"></a></dfn>
     <li><dfn class="idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-shiftkey"><code>shiftKey</code><a class="self-link" href="#dom-mouseevent-shiftkey"></a></dfn>
     <li><dfn class="idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-altkey"><code>altKey</code><a class="self-link" href="#dom-mouseevent-altkey"></a></dfn>
     <li><dfn class="idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-metakey"><code>metaKey</code><a class="self-link" href="#dom-mouseevent-metakey"></a></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-button"><code>button</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-buttons"><code>buttons</code></dfn>
     <li><dfn class="idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-relatedtarget"><code>relatedTarget</code><a class="self-link" href="#dom-mouseevent-relatedtarget"></a></dfn>
     <li>getModifierState(keyArg)
    </dl>
    <h3 class="heading settled" data-level="5.2" id="mouseevent-global-state"><span class="secno">5.2. </span><span class="content">Global State for MouseEvent</span><a class="self-link" href="#mouseevent-global-state"></a></h3>
    <h4 class="heading settled" data-level="5.2.1" id="mouseevent-global-ua"><span class="secno">5.2.1. </span><span class="content">User Agent-Level State</span><a class="self-link" href="#mouseevent-global-ua"></a></h4>
    <p>The UA must maintain the following values that are shared for the entire
    User Agent.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="mouse-button-bitmask">mouse button bitmask</dfn> that tracks the current state of the
    mouse buttons.</p>
    <h4 class="heading settled" data-level="5.2.2" id="mouseevent-global-window"><span class="secno">5.2.2. </span><span class="content">Window-Level State</span><a class="self-link" href="#mouseevent-global-window"></a></h4>
    <p>The UA must maintain the following values that are shared for the Window.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="last-mouse-element">last mouse element</dfn> value (initially undefined) that keeps track
    of the last <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element">Element</a></code> that we sent a MouseEvent to.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="last-mouse-dom-path">last mouse DOM path</dfn> value (initially empty) that contains a snapshot
    of the ancestors <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#element" id="ref-for-element①">Element</a></code>s of the <a data-link-type="dfn" href="#last-mouse-element" id="ref-for-last-mouse-element">last mouse element</a> when the most recent mouse
    event was sent.</p>
    <div class="algorithm" data-algorithm="initialize-a-mouseevent">
     <h3 class="heading settled" data-level="5.3" id="initialize a mouseevent"><span class="secno">5.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-a-mouseevent">initialize a MouseEvent</dfn></span><a class="self-link" href="#initialize%20a%20mouseevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent②">MouseEvent</a></code> to initialize</p>
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget②">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-uievent" id="ref-for-initialize-a-uievent">Initialize a UIEvent</a> with <var>event</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Initialize the following public attributes</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-screenx" id="ref-for-dom-mouseevent-screenx">screenX</a></code> = the x-coordinate of the position where the event occurred
relative to the origin of the desktop</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-screeny" id="ref-for-dom-mouseevent-screeny">screenY</a></code> = the y-coordinate of the position where the event occurred
relative to the origin of the desktop</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-clientx" id="ref-for-dom-mouseevent-clientx">clientX</a></code> = the x-coordinate of the position where the event occurred
relative to the origin of the viewport</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-clienty" id="ref-for-dom-mouseevent-clienty">clientY</a></code> = the y-coordinate of the position where the event occurred
relative to the origin of the <a data-link-type="dfn" href="https://www.w3.org/TR/CSS2/visuren.html#viewport" id="ref-for-viewport">viewport</a></p>
        <li data-md>
         <p><a data-link-type="dfn" href="#set-event-modifiers" id="ref-for-set-event-modifiers">Set event modifiers</a> with <var>event</var></p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-button" id="ref-for-dom-mouseevent-button">button</a></code> = 0</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-buttons" id="ref-for-dom-mouseevent-buttons">buttons</a></code> = <a data-link-type="dfn" href="#mouse-button-bitmask" id="ref-for-mouse-button-bitmask">mouse button bitmask</a></p>
       </ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-pointerlock-attributes-for-mouseevent" id="ref-for-initialize-pointerlock-attributes-for-mouseevent">Initialize PointerLock attributes for MouseEvent</a> with <var>event</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-cssom-attributes-for-mouseevent" id="ref-for-initialize-cssom-attributes-for-mouseevent">Initialize CSSOM attributes for MouseEvent</a> with <var>event</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="create-a-mouseevent">
     <h3 class="heading settled" data-level="5.4" id="create a mouseevent"><span class="secno">5.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-mouseevent">create a MouseEvent</dfn></span><a class="self-link" href="#create%20a%20mouseevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget③">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>event</var> = the result of <a href="https://dom.spec.whatwg.org/#concept-event-create">creating a new MouseEvent</a></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-mouseevent" id="ref-for-initialize-a-mouseevent">Initialize a MouseEvent</a> with <var>event</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Return <var>event</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="calculate-mouseevent-button-attribute">
     <h3 class="heading settled" data-level="5.5" id="calculate mouseevent button attribute"><span class="secno">5.5. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="calculate-mouseevent-button-attribute">calculate MouseEvent button attribute</dfn></span><a class="self-link" href="#calculate%20mouseevent%20button%20attribute"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>mbutton</var>, an ID that identifies a mouse button</p>
      <dt data-md>Output
      <dd data-md>
       <p>A button ID suitable for storing in the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent③">MouseEvent</a></code>'s <code class="idl"><a data-link-type="idl" href="#dom-mouseevent-button" id="ref-for-dom-mouseevent-button①">button</a></code> attribute</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <var>mbutton</var> is the primary mouse button, then return 0</p>
      <li data-md>
       <p>If <var>mbutton</var> is the auxiliary (middle)  mouse button, then return 1</p>
      <li data-md>
       <p>If <var>mbutton</var> is the secondary mouse button, then return 2</p>
      <li data-md>
       <p>If <var>mbutton</var> is the X1 (back) button, then return 3</p>
      <li data-md>
       <p>If <var>mbutton</var> is the X2 (forward) button, then return 4</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="set-mouseevent-attributes-from-native">
     <h3 class="heading settled" data-level="5.6" id="set mouseevent attributes from native"><span class="secno">5.6. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-mouseevent-attributes-from-native">set MouseEvent attributes from native</dfn></span><a class="self-link" href="#set%20mouseevent%20attributes%20from%20native"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent④">MouseEvent</a></code> to initialize</p>
      <dd data-md>
       <p><var>native</var>, the native mouse event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-b7b1e314"><a class="self-link" href="#issue-b7b1e314"></a> TODO</p>
     <ol>
      <li data-md>
       <p>If <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type①">type</a></code> is one of [ mousedown, mouseup ], then</p>
       <ol>
        <li data-md>
         <p>Let <var>mbutton</var> be an ID from <var>native</var> that identifies which mouse button was pressed</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-button" id="ref-for-dom-mouseevent-button②">button</a></code> = <a data-link-type="dfn" href="#calculate-mouseevent-button-attribute" id="ref-for-calculate-mouseevent-button-attribute">calculate MouseEvent button attribute</a> with <var>mbutton</var></p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-mouse-down">
     <h3 class="heading settled" data-level="5.7" id="handle native mouse down"><span class="secno">5.7. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-mouse-down">handle native mouse down</dfn></span><a class="self-link" href="#handle%20native%20mouse%20down"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>native</var>, the native mousedown</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>mbutton</var> be an ID from <var>native</var> that identifies which mouse button was pressed</p>
      <li data-md>
       <p>Update the <a data-link-type="dfn" href="#mouse-button-bitmask" id="ref-for-mouse-button-bitmask①">mouse button bitmask</a> as follows:</p>
       <ol>
        <li data-md>
         <p>If <var>mbutton</var> is the primary mouse button, then set the 0x01 bit</p>
        <li data-md>
         <p>If <var>mbutton</var> is the secondary mouse button, then set the 0x02 bit</p>
        <li data-md>
         <p>If <var>mbutton</var> is the auxiliary (middle) mouse button, then set the 0x04 bit</p>
       </ol>
       <p class="issue" id="issue-e1271e39"><a class="self-link" href="#issue-e1271e39"></a> Other buttons can be added starting with 0x08</p>
      <li data-md>
       <p>Let <var>target</var> = <a data-link-type="dfn" href="#hit-test" id="ref-for-hit-test">hit test</a> with viewport-relative coordinates from <var>native</var></p>
      <li data-md>
       <p>Let <var>event</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent">create a MouseEvent</a> with "mousedown", <var>target</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#set-mouseevent-attributes-from-native" id="ref-for-set-mouseevent-attributes-from-native">Set MouseEvent attributes from native</a> with <var>native</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#maybe-send-pointerdown-event" id="ref-for-maybe-send-pointerdown-event">Maybe send pointerdown event</a> with <var>event</var></p>
      <li data-md>
       <p>Let <var>result</var> = <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch">dispatch</a> <var>event</var> at <var>target</var></p>
      <li data-md>
       <p>If <var>result</var> is true and <var>target</var> is a <a data-link-type="dfn" href="https://html.spec.whatwg.org/#focusable-area" id="ref-for-focusable-area">focusable area</a> that is <a data-link-type="dfn" href="https://html.spec.whatwg.org/#click-focusable" id="ref-for-click-focusable">click focusable</a>, then</p>
       <ol>
        <li data-md>
         <p>Run the <a data-link-type="dfn" href="https://html.spec.whatwg.org/#focusing-steps" id="ref-for-focusing-steps">focusing steps</a> at <var>target</var></p>
       </ol>
      <li data-md>
       <p>if <var>mbutton</var> is the secondary mouse button, then</p>
       <ol>
        <li data-md>
         <p>Let <var>menuevent</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent①">create a MouseEvent</a> with "contextmenu", <var>target</var></p>
        <li data-md>
         <p>Let <var>result</var> = <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①">dispatch</a> <var>menuevent</var> at <var>target</var></p>
        <li data-md>
         <p>If <var>result</var> is true, then show the UA context menu</p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-mouse-up">
     <h3 class="heading settled" data-level="5.8" id="handle native mouse up"><span class="secno">5.8. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-mouse-up">handle native mouse up</dfn></span><a class="self-link" href="#handle%20native%20mouse%20up"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>native</var>, the native mouseup</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="note" role="note"><span>Note:</span> Other mouse events can occur between the mousedown and mouseup.</p>
     <ol>
      <li data-md>
       <p>Let <var>mbutton</var> be an ID from <var>native</var> that identifies which mouse button was pressed</p>
      <li data-md>
       <p>Update the <a data-link-type="dfn" href="#mouse-button-bitmask" id="ref-for-mouse-button-bitmask②">mouse button bitmask</a> as follows:</p>
       <ol>
        <li data-md>
         <p>If <var>mbutton</var> is the primary mouse button, then clear the 0x01 bit</p>
        <li data-md>
         <p>If <var>mbutton</var> is the secondary mouse button, then clear the 0x02 bit</p>
        <li data-md>
         <p>If <var>mbutton</var> is the auxiliary (middle) mouse button, then clear the 0x04 bit</p>
       </ol>
      <li data-md>
       <p>Let <var>target</var> = <a data-link-type="dfn" href="#hit-test" id="ref-for-hit-test①">hit test</a> with viewport-relative coordinates from <var>native</var></p>
      <li data-md>
       <p>Let <var>event</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent②">create a MouseEvent</a> with "mouseup", <var>target</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#set-mouseevent-attributes-from-native" id="ref-for-set-mouseevent-attributes-from-native①">Set MouseEvent attributes from native</a> with <var>native</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#maybe-send-pointerup-event" id="ref-for-maybe-send-pointerup-event">Maybe send pointerup event</a> with <var>event</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch②">dispatch</a> <var>event</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-mouse-click">
     <h3 class="heading settled" data-level="5.9" id="handle native mouse click"><span class="secno">5.9. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-mouse-click">handle native mouse click</dfn></span><a class="self-link" href="#handle%20native%20mouse%20click"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>native</var>, the native mouse click</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="note" role="note"><span>Note:</span> The platform should call this immediately after <a data-link-type="dfn" href="#handle-native-mouse-up" id="ref-for-handle-native-mouse-up①">handle native mouse up</a> for
    mouseups that generate clicks.</p>
     <ol>
      <li data-md>
       <p>Let <var>mbutton</var> be an ID from <var>native</var> that identifies which mouse button was pressed</p>
      <li data-md>
       <p>Let <var>target</var> = <a data-link-type="dfn" href="#hit-test" id="ref-for-hit-test②">hit test</a> with viewport-relative coordinates from <var>native</var></p>
      <li data-md>
       <p>Let <var>eventType</var> = "auxclick"</p>
      <li data-md>
       <p>If <var>mbutton</var> is the primary mouse button, then</p>
       <ol>
        <li data-md>
         <p>Set <var>eventType</var> = "click"</p>
       </ol>
      <li data-md>
       <p>Let <var>event</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent③">create a MouseEvent</a> with <var>eventType</var> and <var>target</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#set-mouseevent-attributes-from-native" id="ref-for-set-mouseevent-attributes-from-native②">Set MouseEvent attributes from native</a> with <var>native</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch③">dispatch</a> <var>event</var> at <var>target</var></p>
     </ol>
     <p class="note" role="note"><span>Note:</span> Any "default action" is handled during dispatch by triggering the <a href="https://dom.spec.whatwg.org/#eventtarget-activation-behavior">activation behavior</a> algorithm for the target. So there is no need for handle that here.
    However, need to verify that the existing spec handles disabled/css-pointer-events/inert/...</p>
    </div>
    <div class="algorithm" data-algorithm="handle-native-mouse-double-click">
     <h3 class="heading settled" data-level="5.10" id="handle native mouse double click"><span class="secno">5.10. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-mouse-double-click">handle native mouse double click</dfn></span><a class="self-link" href="#handle%20native%20mouse%20double%20click"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>native</var>, the native mouse double click</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="note" role="note"><span>Note:</span> This should be called immediately after handle native mouse click for
    mouse clicks that generate double clicks.</p>
     <ol>
      <li data-md>
       <p>Let <var>mbutton</var> be an ID from <var>native</var> that identifies which mouse button was pressed</p>
      <li data-md>
       <p>If <var>mbutton</var> is not the primary mouse button, then return</p>
      <li data-md>
       <p>Let <var>target</var> = <a data-link-type="dfn" href="#hit-test" id="ref-for-hit-test③">hit test</a> with viewport-relative coordinates from <var>native</var></p>
      <li data-md>
       <p>Let <var>event</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent④">create a MouseEvent</a> with "dblclick" and <var>target</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#set-mouseevent-attributes-from-native" id="ref-for-set-mouseevent-attributes-from-native③">Set MouseEvent attributes from native</a> with <var>native</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch④">dispatch</a> <var>event</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-mouse-move">
     <h3 class="heading settled" data-level="5.11" id="handle native mouse move"><span class="secno">5.11. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-mouse-move">handle native mouse move</dfn></span><a class="self-link" href="#handle%20native%20mouse%20move"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>native</var>, the native mouse move</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-5a61aefb"><a class="self-link" href="#issue-5a61aefb"></a> This algorithm makes assumptions about the dispatch of PointerEvents because they
    are not currently specified explicitly. Once <a href="https://github.com/w3c/pointerevents/issues/285">pointerevents/285</a> is resolved
    this may need to be updated.</p>
     <ol>
      <li data-md>
       <p>Let <var>target</var> = <a data-link-type="dfn" href="#hit-test" id="ref-for-hit-test④">hit test</a> with viewport-relative coordinates from <var>native</var></p>
      <li data-md>
       <p>Let <var>targetDomPath</var> = <a data-link-type="dfn" href="#calculate-dom-path" id="ref-for-calculate-dom-path">calculate DOM path</a></p>
      <li data-md>
       <p>Generate events for leaving the current element:</p>
       <ol>
        <li data-md>
         <p>If <a data-link-type="dfn" href="#last-mouse-element" id="ref-for-last-mouse-element①">last mouse element</a> is defined and not equal to <var>target</var>, then</p>
         <ol>
          <li data-md>
           <p>Let <var>mouseout</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent⑤">create a MouseEvent</a> with "mouseout" and <a data-link-type="dfn" href="#last-mouse-element" id="ref-for-last-mouse-element②">last mouse element</a></p>
         </ol>
         <p class="issue" id="issue-6c6e5fe0"><a class="self-link" href="#issue-6c6e5fe0"></a> TODO: Set <var>mouseout</var> attributes from <var>native</var>. +CSSOM attributes</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="#maybe-send-pointerout-event" id="ref-for-maybe-send-pointerout-event">Maybe send pointerout event</a> with <var>mouseout</var></p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch⑤">Dispatch</a> <var>mouseout</var> at <var>target</var></p>
           <p class="issue" id="issue-f864a356"><a class="self-link" href="#issue-f864a356"></a> Verify behavior when canceled (appears to have no effect).</p>
          <li data-md>
           <p>Let <var>leaveElements</var> be a copy of <a data-link-type="dfn" href="#last-mouse-dom-path" id="ref-for-last-mouse-dom-path">last mouse DOM path</a> with all
elements common to <var>targetDomPath</var> removed.</p>
          <li data-md>
           <p>For each <var>element</var> in <var>leaveElements</var>, do</p>
           <ol>
            <li data-md>
             <p>Let <var>mouseleave</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent⑥">create a MouseEvent</a> with "mouseleave" and <var>element</var></p>
            <li data-md>
             <p>Set <var>mouseleave</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-bubbles" id="ref-for-dom-event-bubbles①">bubbles</a></code> = false</p>
            <li data-md>
             <p>Set <var>mouseleave</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-cancelable" id="ref-for-dom-event-cancelable①">cancelable</a></code> = false</p>
           </ol>
           <p class="issue" id="issue-ab0000b0"><a class="self-link" href="#issue-ab0000b0"></a> Compat: Value of event.composed. Spec says false.
Chrome/Linux = true
Firefox/Linux = false</p>
           <ol>
            <li data-md>
             <p><a data-link-type="dfn" href="#maybe-send-pointerleave-event" id="ref-for-maybe-send-pointerleave-event">Maybe send pointerleave event</a> with <var>mouseleave</var></p>
            <li data-md>
             <p>Let <var>result</var> = <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch⑥">dispatch</a> <var>mouseleave</var> at <var>element</var></p>
           </ol>
         </ol>
       </ol>
      <li data-md>
       <p>Generate events for entering the new element:</p>
       <ol>
        <li data-md>
         <p>If <var>target</var> is not <a data-link-type="dfn" href="#last-mouse-element" id="ref-for-last-mouse-element③">last mouse element</a>, then</p>
         <ol>
          <li data-md>
           <p>Let <var>mouseover</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent⑦">create a MouseEvent</a> with "mouseover" and <var>target</var></p>
         </ol>
         <p class="issue" id="issue-6c6e5fe0①"><a class="self-link" href="#issue-6c6e5fe0①"></a> TODO: Set <var>mouseout</var> attributes from <var>native</var>. +CSSOM attributes</p>
         <ol>
          <li data-md>
           <p><a data-link-type="dfn" href="#maybe-send-pointerover-event" id="ref-for-maybe-send-pointerover-event">Maybe send pointerover event</a> with <var>mouseover</var></p>
          <li data-md>
           <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch⑦">Dispatch</a> <var>mouseout</var> at <var>target</var></p>
           <p class="issue" id="issue-f864a356①"><a class="self-link" href="#issue-f864a356①"></a> Verify behavior when canceled (appears to have no effect).</p>
          <li data-md>
           <p>Let <var>enterElements</var> be a copy of <var>targetDomPath</var> with all
elements common to <a data-link-type="dfn" href="#last-mouse-dom-path" id="ref-for-last-mouse-dom-path①">last mouse DOM path</a> removed.</p>
          <li data-md>
           <p>For each <var>element</var> in <var>enterElements</var>, do</p>
           <ol>
            <li data-md>
             <p>Let <var>mouseenter</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent⑧">create a MouseEvent</a> with "mouseenter" and <var>element</var></p>
            <li data-md>
             <p>Set <var>mouseenter</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-bubbles" id="ref-for-dom-event-bubbles②">bubbles</a></code> = false</p>
            <li data-md>
             <p>Set <var>mouseenter</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-cancelable" id="ref-for-dom-event-cancelable②">cancelable</a></code> = false</p>
           </ol>
           <p class="issue" id="issue-ab0000b0①"><a class="self-link" href="#issue-ab0000b0①"></a> Compat: Value of event.composed. Spec says false.
Chrome/Linux = true
Firefox/Linux = false</p>
           <ol>
            <li data-md>
             <p><a data-link-type="dfn" href="#maybe-send-pointerenter-event" id="ref-for-maybe-send-pointerenter-event">Maybe send pointerenter event</a> with <var>mouseenter</var></p>
           </ol>
           <p class="issue" id="issue-9a3a918a"><a class="self-link" href="#issue-9a3a918a"></a> Compat for shadow DOM elements
Chrome/Linux fires this event at the element and the shadow root</p>
           <ol>
            <li data-md>
             <p>Let <var>result</var> = <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch⑧">dispatch</a> <var>mouseenter</var> at <var>element</var></p>
           </ol>
          <li data-md>
           <p>Set <a data-link-type="dfn" href="#last-mouse-element" id="ref-for-last-mouse-element④">last mouse element</a> to <var>target</var></p>
          <li data-md>
           <p>Set <a data-link-type="dfn" href="#last-mouse-dom-path" id="ref-for-last-mouse-dom-path②">last mouse DOM path</a> to <var>targetDomPath</var></p>
         </ol>
       </ol>
      <li data-md>
       <p>Let <var>mousemove</var> = <a data-link-type="dfn" href="#create-a-mouseevent" id="ref-for-create-a-mouseevent⑨">create a MouseEvent</a> with "mousemove" and <var>element</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#set-pointerlock-attributes-for-mousemove" id="ref-for-set-pointerlock-attributes-for-mousemove">Set PointerLock attributes for mousemove</a></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#maybe-send-pointermove-event" id="ref-for-maybe-send-pointermove-event">Maybe send pointermove event</a> with <var>mousemove</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch⑨">Dispatch</a> <var>mousemove</var> at <var>element</var></p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="6" id="keyboard event"><span class="secno">6. </span><span class="content">Keyboard Event</span><a class="self-link" href="#keyboard%20event"></a></h2>
    <h3 class="heading settled" data-level="6.1" id="keyboardevent-interface"><span class="secno">6.1. </span><span class="content">KeyboardEvent Interface</span><a class="self-link" href="#keyboardevent-interface"></a></h3>
    <p>A <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#keyboardevent" id="ref-for-keyboardevent①">KeyboardEvent</a></code> has the following:</p>
    <dl>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="const" data-export id="dom-keyboardevent-dom_key_location_standard"><code>DOM_KEY_LOCATION_STANDARD</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="const" data-export id="dom-keyboardevent-dom_key_location_left"><code>DOM_KEY_LOCATION_LEFT</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="const" data-export id="dom-keyboardevent-dom_key_location_right"><code>DOM_KEY_LOCATION_RIGHT</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="const" data-export id="dom-keyboardevent-dom_key_location_numpad"><code>DOM_KEY_LOCATION_NUMPAD</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-key"><code>key</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-code"><code>code</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-location"><code>location</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-ctrlkey"><code>ctrlKey</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-shiftkey"><code>shiftKey</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-altkey"><code>altKey</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-metakey"><code>metaKey</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-repeat"><code>repeat</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-iscomposing"><code>isComposing</code></dfn>
     <li>getModifierState(keyArg) - handled by <a data-link-type="dfn" href="#get-modifier-state" id="ref-for-get-modifier-state">get modifier state</a>
    </dl>
    <p>Along with the following historical attributes:</p>
    <dl>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-keycode"><code>keyCode</code></dfn>
     <li><dfn class="idl-code" data-dfn-for="KeyboardEvent" data-dfn-type="attribute" data-export id="dom-keyboardevent-keychar"><code>keyChar</code><a class="self-link" href="#dom-keyboardevent-keychar"></a></dfn>
    </dl>
    <p>And the following internal state:</p>
    <dl>
     <li><dfn class="dfn-paneled" data-dfn-for="KeyboardEvent" data-dfn-type="dfn" data-noexport id="keyboardevent-shift-flag">shift flag</dfn>
     <li><dfn class="dfn-paneled" data-dfn-for="KeyboardEvent" data-dfn-type="dfn" data-noexport id="keyboardevent-control-flag">control flag</dfn>
     <li><dfn class="dfn-paneled" data-dfn-for="KeyboardEvent" data-dfn-type="dfn" data-noexport id="keyboardevent-alt-flag">alt flag</dfn>
     <li><dfn class="dfn-paneled" data-dfn-for="KeyboardEvent" data-dfn-type="dfn" data-noexport id="keyboardevent-altgraph-flag">altgraph flag</dfn>
     <li><dfn class="dfn-paneled" data-dfn-for="KeyboardEvent" data-dfn-type="dfn" data-noexport id="keyboardevent-meta-flag">meta flag</dfn>
     <li><dfn class="dfn-paneled" data-dfn-for="KeyboardEvent" data-dfn-type="dfn" data-noexport id="keyboardevent-capslock-flag">capslock flag</dfn>
     <li><dfn class="dfn-paneled" data-dfn-for="KeyboardEvent" data-dfn-type="dfn" data-noexport id="keyboardevent-numlock-flag">numlock flag</dfn>
    </dl>
    <h3 class="heading settled" data-level="6.2" id="keyboardevent-global-state"><span class="secno">6.2. </span><span class="content">Global State for KeyboardEvent</span><a class="self-link" href="#keyboardevent-global-state"></a></h3>
    <h4 class="heading settled" data-level="6.2.1" id="keyboardevent-global-ua"><span class="secno">6.2.1. </span><span class="content">User Agent-Level State</span><a class="self-link" href="#keyboardevent-global-ua"></a></h4>
    <p>The UA must maintain the following values that are shared for the entire
    User Agent.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="key-modifier-state">key modifier state</dfn> (initially empty) that keeps track of the current
    state of each <a data-link-type="dfn" href="https://www.w3.org/TR/uievents-key/#keys-modifier" id="ref-for-keys-modifier">modifier key</a> available on the system.</p>
    <h4 class="heading settled" data-level="6.2.2" id="keyboardevent-global-window"><span class="secno">6.2.2. </span><span class="content">Window-Level State</span><a class="self-link" href="#keyboardevent-global-window"></a></h4>
    <p>The UA must maintain the following values that are shared for the Window.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="suppress-key-input-events-flag">suppress key input events flag</dfn> (initially false) that is used to suppress
    input events when the initial keydown event is canceled.</p>
    <div class="algorithm" data-algorithm="initialize-a-keyboardevent">
     <h3 class="heading settled" data-level="6.3" id="initialize a keyboardevent"><span class="secno">6.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-a-keyboardevent">initialize a KeyboardEvent</dfn></span><a class="self-link" href="#initialize%20a%20keyboardevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#keyboardevent" id="ref-for-keyboardevent②">KeyboardEvent</a></code> to initialize</p>
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget④">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-uievent" id="ref-for-initialize-a-uievent①">Initialize a UIEvent</a> with <var>event</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Initialize the following public attributes</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-key" id="ref-for-dom-keyboardevent-key">key</a></code> = ""</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-code" id="ref-for-dom-keyboardevent-code">code</a></code> = ""</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-location" id="ref-for-dom-keyboardevent-location">location</a></code> = <code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-dom_key_location_standard" id="ref-for-dom-keyboardevent-dom_key_location_standard">DOM_KEY_LOCATION_STANDARD</a></code></p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-shiftkey" id="ref-for-dom-keyboardevent-shiftkey">shiftKey</a></code> = false</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-ctrlkey" id="ref-for-dom-keyboardevent-ctrlkey">ctrlKey</a></code> = false</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-altkey" id="ref-for-dom-keyboardevent-altkey">altKey</a></code> = false</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-metakey" id="ref-for-dom-keyboardevent-metakey">metaKey</a></code> = false</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-repeat" id="ref-for-dom-keyboardevent-repeat">repeat</a></code> = false</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-iscomposing" id="ref-for-dom-keyboardevent-iscomposing">isComposing</a></code> = false</p>
       </ol>
      <li data-md>
       <p>Initialize the following historical attributes</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-keycode" id="ref-for-dom-keyboardevent-keycode">keyCode</a></code> = 0</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-charcode" id="ref-for-dom-keyboardevent-charcode">charCode</a></code> = 0</p>
       </ol>
      <li data-md>
       <p>Initialize the following internal state</p>
       <p class="issue" id="issue-b4147fbf"><a class="self-link" href="#issue-b4147fbf"></a> Need to review: ScrollLock, Hyper, Super, and (for virtual keyboards) Symbol, SymbolLock</p>
       <ol>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-shift-flag" id="ref-for-keyboardevent-shift-flag">shift flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-control-flag" id="ref-for-keyboardevent-control-flag">control flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-alt-flag" id="ref-for-keyboardevent-alt-flag">alt flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-altgraph-flag" id="ref-for-keyboardevent-altgraph-flag">altgraph flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-meta-flag" id="ref-for-keyboardevent-meta-flag">meta flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-capslock-flag" id="ref-for-keyboardevent-capslock-flag">capslock flag</a></p>
        <li data-md>
         <p>Unset <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-numlock-flag" id="ref-for-keyboardevent-numlock-flag">numlock flag</a></p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="create-a-keyboardevent">
     <h3 class="heading settled" data-level="6.4" id="create a keyboardevent"><span class="secno">6.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-keyboardevent">create a KeyboardEvent</dfn></span><a class="self-link" href="#create%20a%20keyboardevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget⑤">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>e</var> = the result of <a href="https://dom.spec.whatwg.org/#concept-event-create">creating a new KeyboardEvent</a></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-keyboardevent" id="ref-for-initialize-a-keyboardevent">Initialize a KeyboardEvent</a> with <var>e</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Return <var>e</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="set-event-modifiers">
     <h3 class="heading settled" data-level="6.5" id="set event modifiers"><span class="secno">6.5. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-event-modifiers">set event modifiers</dfn></span><a class="self-link" href="#set%20event%20modifiers"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#keyboardevent" id="ref-for-keyboardevent③">KeyboardEvent</a></code> or <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent⑤">MouseEvent</a></code> to update</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-359c7cda"><a class="self-link" href="#issue-359c7cda"></a> eval: ScrollLock, Hyper, Super, and (for virtual keyboards) Symbol, SymbolLock</p>
     <ol>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-shift-flag" id="ref-for-keyboardevent-shift-flag①">shift flag</a> if <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state">key modifier state</a> includes "Shift", unset it otherwise</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-control-flag" id="ref-for-keyboardevent-control-flag①">control flag</a> if <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state①">key modifier state</a> includes "Control", unset it otherwise</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-alt-flag" id="ref-for-keyboardevent-alt-flag①">alt flag</a> if <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state②">key modifier state</a> includes "Alt", unset it otherwise</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-altgraph-flag" id="ref-for-keyboardevent-altgraph-flag①">altgraph flag</a> if <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state③">key modifier state</a> includes "AltGraph", unset it otherwise</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-meta-flag" id="ref-for-keyboardevent-meta-flag①">meta flag</a> if <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state④">key modifier state</a> includes "Meta", unset it otherwise</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-capslock-flag" id="ref-for-keyboardevent-capslock-flag①">capslock flag</a> if <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state⑤">key modifier state</a> includes "CapsLock", unset it otherwise</p>
      <li data-md>
       <p>Set <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-numlock-flag" id="ref-for-keyboardevent-numlock-flag①">numlock flag</a> if <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state⑥">key modifier state</a> includes "NumLock", unset it otherwise</p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-shiftkey" id="ref-for-dom-keyboardevent-shiftkey①">shiftKey</a></code> = true if the event’s <a data-link-type="dfn" href="#keyboardevent-shift-flag" id="ref-for-keyboardevent-shift-flag②">shift flag</a> is set, false otherwise</p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-ctrlkey" id="ref-for-dom-keyboardevent-ctrlkey①">ctrlKey</a></code> = true if the event’s <a data-link-type="dfn" href="#keyboardevent-control-flag" id="ref-for-keyboardevent-control-flag②">control flag</a> is set, false otherwise</p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-altkey" id="ref-for-dom-keyboardevent-altkey①">altKey</a></code> = true if the event’s <a data-link-type="dfn" href="#keyboardevent-alt-flag" id="ref-for-keyboardevent-alt-flag②">alt flag</a> or <a data-link-type="dfn" href="#keyboardevent-altgraph-flag" id="ref-for-keyboardevent-altgraph-flag②">altgraph flag</a> is set, false otherwise</p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-metakey" id="ref-for-dom-keyboardevent-metakey①">metaKey</a></code> = true if the event’s <a data-link-type="dfn" href="#keyboardevent-meta-flag" id="ref-for-keyboardevent-meta-flag②">meta flag</a> is set, false otherwise</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="set-keyboardevent-attributes">
     <h3 class="heading settled" data-level="6.6" id="set keyboardevent attributes"><span class="secno">6.6. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-keyboardevent-attributes">set KeyboardEvent attributes</dfn></span><a class="self-link" href="#set%20keyboardevent%20attributes"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#keyboardevent" id="ref-for-keyboardevent④">KeyboardEvent</a></code> to initialize</p>
      <dd data-md>
       <p><var>nativeKey</var>, native key info</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Set the following public attributes</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-key" id="ref-for-dom-keyboardevent-key①">key</a></code> = the key attribute value for this key press</p>
         <p class="issue" id="issue-d5cc0d9d"><a class="self-link" href="#issue-d5cc0d9d"></a> Needs more formal description of non-printable characters</p>
         <p class="issue" id="issue-2200ddf1"><a class="self-link" href="#issue-2200ddf1"></a> Need to include description of how AltGraph should be handled.
See <a href="https://github.com/w3c/uievents/issues/147">uievents/147</a></p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-code" id="ref-for-dom-keyboardevent-code①">code</a></code> = the key code attribute value corresponding to the physical
key that was pressed.</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-location" id="ref-for-dom-keyboardevent-location①">location</a></code> = the result of <a data-link-type="dfn" href="#calculate-key-location" id="ref-for-calculate-key-location">calculate key location</a> with <var>event</var>.code</p>
        <li data-md>
         <p>if <var>nativeKey</var> indicates that this is a repeat key event</p>
         <ol>
          <li data-md>
           <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-repeat" id="ref-for-dom-keyboardevent-repeat①">repeat</a></code></p>
         </ol>
        <li data-md>
         <p><a data-link-type="dfn" href="#set-event-modifiers" id="ref-for-set-event-modifiers①">set event modifiers</a> with <var>event</var></p>
       </ol>
      <li data-md>
       <p>Set the following historical attributes</p>
       <p class="issue" id="issue-40bc3077"><a class="self-link" href="#issue-40bc3077"></a> TODO: For historical reasons, we can’t have a formal description of these
fields without recognizing that certain UAs produce different values.</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-keycode" id="ref-for-dom-keyboardevent-keycode①">keyCode</a></code> = ???</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-keyboardevent-charcode" id="ref-for-dom-keyboardevent-charcode①">charCode</a></code> = ???</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-which" id="ref-for-dom-keyboardevent-which①">which</a></code> = ???</p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="calculate-key-location">
     <h3 class="heading settled" data-level="6.7" id="calculate key locationinitialize a keyboardevent"><span class="secno">6.7. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="calculate-key-location">calculate key location</dfn></span><a class="self-link" href="#calculate%20key%20locationinitialize%20a%20keyboardevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>code</var>, the <code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-code" id="ref-for-dom-keyboardevent-code②">code</a></code> for the key</p>
      <dt data-md>Output
      <dd data-md>
       <p>The DOM key location for the specified key</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <var>code</var> is any of [ "AltLeft", "ControlLeft", "MetaLeft", "ShiftLeft"], then</p>
       <ol>
        <li data-md>
         <p>return <code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-dom_key_location_left" id="ref-for-dom-keyboardevent-dom_key_location_left">DOM_KEY_LOCATION_LEFT</a></code></p>
       </ol>
      <li data-md>
       <p>If <var>code</var> is any of [ "AltRight", "ControlRight", "MetaRight", "ShiftRight"], then</p>
       <ol>
        <li data-md>
         <p>return <code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-dom_key_location_right" id="ref-for-dom-keyboardevent-dom_key_location_right">DOM_KEY_LOCATION_RIGHT</a></code></p>
       </ol>
      <li data-md>
       <p>If <var>code</var> matches any of the values in the <a href="https://www.w3.org/TR/uievents-code/#key-numpad-section">numpad section</a>, then</p>
       <ol>
        <li data-md>
         <p>return <code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-dom_key_location_numpad" id="ref-for-dom-keyboardevent-dom_key_location_numpad">DOM_KEY_LOCATION_NUMPAD</a></code></p>
       </ol>
      <li data-md>
       <p>return <code class="idl"><a data-link-type="idl" href="#dom-keyboardevent-dom_key_location_standard" id="ref-for-dom-keyboardevent-dom_key_location_standard①">DOM_KEY_LOCATION_STANDARD</a></code></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="get-modifier-state">
     <h3 class="heading settled" data-level="6.8" id="get modifier state"><span class="secno">6.8. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="get-modifier-state">get modifier state</dfn></span><a class="self-link" href="#get%20modifier%20state"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#keyboardevent" id="ref-for-keyboardevent⑤">KeyboardEvent</a></code> to initialize</p>
      <dd data-md>
       <p><var>modifier</var>, a DOMString containing the name of the modifier key</p>
      <dt data-md>Output
      <dd data-md>
       <p>True if the modifier is currently set, false otherwise</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <var>modifier</var> is "Shift", then return true if <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-shift-flag" id="ref-for-keyboardevent-shift-flag③">shift flag</a> is set</p>
      <li data-md>
       <p>If <var>modifier</var> is "Control", then return true if <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-control-flag" id="ref-for-keyboardevent-control-flag③">control flag</a> is set</p>
      <li data-md>
       <p>If <var>modifier</var> is "Alt", then return true if <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-alt-flag" id="ref-for-keyboardevent-alt-flag③">alt flag</a> is set</p>
      <li data-md>
       <p>If <var>modifier</var> is "AltGraph", then return true if <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-altgraph-flag" id="ref-for-keyboardevent-altgraph-flag③">altgraph flag</a> is set</p>
      <li data-md>
       <p>If <var>modifier</var> is "Meta", then return true if <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-meta-flag" id="ref-for-keyboardevent-meta-flag③">meta flag</a> is set</p>
      <li data-md>
       <p>If <var>modifier</var> is "CapsLock", then return true if <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-capslock-flag" id="ref-for-keyboardevent-capslock-flag②">capslock flag</a> is set</p>
      <li data-md>
       <p>If <var>modifier</var> is "NumLock", then return true if <var>event</var>’s <a data-link-type="dfn" href="#keyboardevent-numlock-flag" id="ref-for-keyboardevent-numlock-flag②">numlock flag</a> is set</p>
      <li data-md>
       <p>Return false</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-pre-browser-key">
     <h3 class="heading settled" data-level="6.9" id="handle pre browser key"><span class="secno">6.9. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-pre-browser-key">handle pre browser key</dfn></span><a class="self-link" href="#handle%20pre%20browser%20key"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>key</var>, basic info about the key</p>
      <dt data-md>Output
      <dd data-md>
       <p>True is the User Agent has already handled this key</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#keyboard-lock-is-enabled" id="ref-for-keyboard-lock-is-enabled">Keyboard Lock is enabled</a>, then return false</p>
       <p class="note" role="note"><span>Note:</span> Keyboard Lock is not an official standard. This is demonstrating
how it might be integrated.</p>
     </ol>
     <p class="issue" id="issue-95f8c21d"><a class="self-link" href="#issue-95f8c21d"></a> These key shortcuts are defined by the User Agent  (e.g., Cmd-T on Mac).
    They should be defined in such a way that the UA is in control.</p>
     <p class="issue" id="issue-ab1accc3"><a class="self-link" href="#issue-ab1accc3"></a> Need a more complete list of these pre-keydown browser keys, or a better description
    of the sort of keys the UA handles.</p>
     <ol>
      <li data-md>
       <p>If <var>key</var> is the shortcut to create a new tab, then</p>
       <ol>
        <li data-md>
         <p>Create a new tab</p>
        <li data-md>
         <p>Return true</p>
       </ol>
      <li data-md>
       <p>If <var>key</var> is the shortcut to close a window, then</p>
       <ol>
        <li data-md>
         <p>Close the current tab</p>
        <li data-md>
         <p>Return true</p>
       </ol>
     </ol>
     <p class="issue" id="issue-3845ba6b"><a class="self-link" href="#issue-3845ba6b"></a> IME is often provided by the native OS. So the requirements need to be
    defined and added to the <a href="#req-ime">IME Requirements</a> section.</p>
     <p class="issue" id="issue-93e6f32f"><a class="self-link" href="#issue-93e6f32f"></a> How should IME keys be represented. We need the native OS to call <a data-link-type="dfn" href="#enter-composition-mode" id="ref-for-enter-composition-mode">enter composition mode</a> and <a data-link-type="dfn" href="#exit-composition-mode" id="ref-for-exit-composition-mode">exit composition mode</a></p>
     <p class="issue" id="issue-d744c6c4"><a class="self-link" href="#issue-d744c6c4"></a> When should <a data-link-type="dfn" href="#begin-composition" id="ref-for-begin-composition">begin composition</a> be called? How should that be hooked with
    the native IME calls.</p>
     <ol>
      <li data-md>
       <p>Return false</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-post-browser-key">
     <h3 class="heading settled" data-level="6.10" id="handle post browser key"><span class="secno">6.10. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-post-browser-key">handle post browser key</dfn></span><a class="self-link" href="#handle%20post%20browser%20key"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>key</var>, basic info about the key</p>
      <dt data-md>Output
      <dd data-md>
       <p>True is the User Agent has already handled this key</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#keyboard-lock-is-enabled" id="ref-for-keyboard-lock-is-enabled①">Keyboard Lock is enabled</a>, then return false</p>
       <p class="issue" id="issue-713be494"><a class="self-link" href="#issue-713be494"></a> Placeholder until there’s an actual agreed-upon definition for Keyboard Lock.</p>
      <li data-md>
       <p>If <var>key</var> is:</p>
       <ol>
        <li data-md>
         <p>The shortcut to cut (e.g., ctrl-x), then <a data-link-type="dfn" href="#handle-native-cut" id="ref-for-handle-native-cut①">Handle native cut</a></p>
        <li data-md>
         <p>The shortcut to copy (e.g., ctrl-c), then <a data-link-type="dfn" href="#handle-native-copy" id="ref-for-handle-native-copy①">Handle native copy</a></p>
        <li data-md>
         <p>The shortcut to paste (e.g., ctrl-v), then <a data-link-type="dfn" href="#handle-native-paste" id="ref-for-handle-native-paste①">Handle native paste</a></p>
         <p class="issue" id="issue-9a62a3b5"><a class="self-link" href="#issue-9a62a3b5"></a> Need more complete set of post-keydown browser keys. Perhaps define
a set of common browser keys (clipboard, open/close tabs, quit).</p>
        <li data-md>
         <p>And then return true</p>
       </ol>
      <li data-md>
       <p>Return false</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-key-down">
     <h3 class="heading settled" data-level="6.11" id="handle native key down"><span class="secno">6.11. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-key-down">handle native key down</dfn></span><a class="self-link" href="#handle%20native%20key%20down"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>nativeKey</var>, native key info</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Update global modifier key state</p>
      <li data-md>
       <p>If <var>nativKey</var> is left or right Shift key, then add "Shift" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state⑦">key modifier state</a></p>
      <li data-md>
       <p>If <var>nativKey</var> is left or right Control key, then add "Control" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state⑧">key modifier state</a></p>
      <li data-md>
       <p>If <var>nativKey</var> is left or right Alt key, then add "Alt" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state⑨">key modifier state</a></p>
      <li data-md>
       <p>If <var>nativKey</var> is AltGraph key, then add "AltGraph" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state①⓪">key modifier state</a></p>
      <li data-md>
       <p>If <var>nativKey</var> is left or right Meta key, then add "Meta" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state①①">key modifier state</a></p>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#handle-pre-browser-key" id="ref-for-handle-pre-browser-key">handle pre browser key</a> with <var>nativeKey</var>, then</p>
       <p class="note" role="note"><span>Note:</span> Chrome/Firefox handle some BrowserKeys before generating keydown events.
Tested with ctrl-t (to create new tab)</p>
       <ol>
        <li data-md>
         <p>exit</p>
       </ol>
      <li data-md>
       <p>Let target = <a href="https://html.spec.whatwg.org/#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a></p>
      <li data-md>
       <p>Let <var>event</var> = result of <a data-link-type="dfn" href="#create-a-keyboardevent" id="ref-for-create-a-keyboardevent">create a KeyboardEvent</a> with "keydown", <var>target</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#set-keyboardevent-attributes" id="ref-for-set-keyboardevent-attributes">set KeyboardEvent attributes</a> with <var>event</var>, <var>nativeKey</var></p>
      <li data-md>
       <p>Let <var>result</var> = <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①⓪">dispatch</a> <var>event</var> at <var>target</var></p>
       <p class="note" role="note"><span>Note:</span> when in composition, canceling the keydown has no effect
(tested: macOS Chrome; TODO: test other configs)</p>
      <li data-md>
       <p>If the <a data-link-type="dfn" href="#in-composition-flag" id="ref-for-in-composition-flag">in composition flag</a> is set, then</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="#handle-composition-key" id="ref-for-handle-composition-key">handle composition key</a> and exit</p>
       </ol>
      <li data-md>
       <p>Unset the <a data-link-type="dfn" href="#suppress-key-input-events-flag" id="ref-for-suppress-key-input-events-flag">suppress key input events flag</a></p>
      <li data-md>
       <p>If <var>result</var> = false, then</p>
       <ol>
        <li data-md>
         <p>Set the <a data-link-type="dfn" href="#suppress-key-input-events-flag" id="ref-for-suppress-key-input-events-flag①">suppress key input events flag</a></p>
       </ol>
      <li data-md>
       <p>If native platform has separate CHAR event, then</p>
       <p class="issue" id="issue-41fee8f3"><a class="self-link" href="#issue-41fee8f3"></a> Is this check necessary?
Can native CHAR events be ignored or do they contain needed info?</p>
       <ol>
        <li data-md>
         <p>Exit  (because CHAR event will trigger <a data-link-type="dfn" href="#handle-native-key-press" id="ref-for-handle-native-key-press①">handle native key press</a>)</p>
       </ol>
     </ol>
     <ol>
      <li data-md>
       <p>Call <a data-link-type="dfn" href="#handle-native-key-press" id="ref-for-handle-native-key-press②">handle native key press</a> with <var>nativeKey</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-key-up">
     <h3 class="heading settled" data-level="6.12" id="handle native key up"><span class="secno">6.12. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-key-up">handle native key up</dfn></span><a class="self-link" href="#handle%20native%20key%20up"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>nativeKey</var>, native key info</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Update global modifier key state</p>
       <ol>
        <li data-md>
         <p>If <var>nativeKey</var> is left or right Shift key, then remove "Shift" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state①②">key modifier state</a></p>
        <li data-md>
         <p>If <var>nativeKey</var> is left or right Control key, then remove "Control" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state①③">key modifier state</a></p>
        <li data-md>
         <p>If <var>nativeKey</var> is left or right Alt key, then remove "Alt" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state①④">key modifier state</a></p>
        <li data-md>
         <p>If <var>nativeKey</var> is AltGraph key, then remove "AltGraph" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state①⑤">key modifier state</a></p>
        <li data-md>
         <p>If <var>nativeKey</var> is left or right Meta key, then remove "Meta" to <a data-link-type="dfn" href="#key-modifier-state" id="ref-for-key-modifier-state①⑥">key modifier state</a></p>
       </ol>
      <li data-md>
       <p>Let target = <a href="https://html.spec.whatwg.org/#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a></p>
      <li data-md>
       <p>Let <var>event</var> = result of <a data-link-type="dfn" href="#create-a-keyboardevent" id="ref-for-create-a-keyboardevent①">create a KeyboardEvent</a> with "keyup", <var>target</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#set-keyboardevent-attributes" id="ref-for-set-keyboardevent-attributes①">set KeyboardEvent attributes</a> with <var>event</var>, <var>nativeKey</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①①">dispatch</a> <var>event</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-key-press">
     <h3 class="heading settled" data-level="6.13" id="handle native key press"><span class="secno">6.13. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-key-press">handle native key press</dfn></span><a class="self-link" href="#handle%20native%20key%20press"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>nativeKey</var>, native key info</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="note" role="note"><span>Note:</span> This may be called directly if the native platform generates CHAR events that
    are separate from keydown events. Or it may be called from <a data-link-type="dfn" href="#handle-native-key-down" id="ref-for-handle-native-key-down①">handle native key down</a>.</p>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#composition-mode-flag" id="ref-for-composition-mode-flag">composition mode flag</a> is set, then</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="#handle-composition-key" id="ref-for-handle-composition-key①">Handle composition key</a> with <var>nativeKey</var></p>
        <li data-md>
         <p>Exit</p>
       </ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#handle-post-browser-key" id="ref-for-handle-post-browser-key">handle post browser key</a>, then exit</p>
      <li data-md>
       <p>Let <var>target</var> = <a href="https://html.spec.whatwg.org/#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a></p>
       <p class="issue" id="issue-beb23471"><a class="self-link" href="#issue-beb23471"></a> What should happen if the event focus has changed since the keydown event?
What is the appropriate target for the keyup? The current focus or the previous?
Are there security issues (e.g., if it’s not safe to edit the current focus)?</p>
      <li data-md>
       <p>Let <var>key</var> = extract info from <var>nativeKey</var></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#fire-key-input-events" id="ref-for-fire-key-input-events">Fire key input events</a> with <var>key</var> and <var>target</var></p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="7" id="input event"><span class="secno">7. </span><span class="content">Input Event</span><a class="self-link" href="#input%20event"></a></h2>
    <div class="algorithm" data-algorithm="initialize-an-inputevent">
     <h3 class="heading settled" data-level="7.1" id="initialize an Inputevent"><span class="secno">7.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-an-inputevent">initialize an InputEvent</dfn></span><a class="self-link" href="#initialize%20an%20Inputevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>e</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event③">Event</a></code> to initialize</p>
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget⑥">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-uievent" id="ref-for-initialize-a-uievent②">Initialize a UIEvent</a> with <var>e</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Initialize the following public attributes</p>
       <ol>
        <li data-md>
         <p>Set event.data = null</p>
        <li data-md>
         <p>Set event.isComposing = false</p>
        <li data-md>
         <p>Set event.inputType = ""</p>
        <li data-md>
         <p>Set event.composed = true</p>
         <p class="note" role="note"><span>Note:</span> Setting composed to true matches current UA behavior, but it makes more sense
for this to be false.
See <a href="https://github.com/whatwg/html/issues/5453">whatwg/html/5453</a> for discussion.</p>
       </ol>
      <li data-md>
       <p>Initialize the additional editing attributes from [[Input Events]]</p>
       <p class="issue" id="issue-0a3912f8"><a class="self-link" href="#issue-0a3912f8"></a> Move the following into InputEvents spec
(<a href="https://www.w3.org/TR/input-events-1/">level 1</a> or <a href="https://www.w3.org/TR/input-events-2/">level 2</a>)
since that’s where these attributes are defined.</p>
       <ol>
        <li data-md>
         <p>Set <var>e</var>.dataTransfer = false</p>
        <li data-md>
         <p>Set <var>e</var>.targetRanges = []</p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="create-an-inputevent">
     <h3 class="heading settled" data-level="7.2" id="create an inputevent"><span class="secno">7.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-an-inputevent">create an InputEvent</dfn></span><a class="self-link" href="#create%20an%20inputevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget⑦">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>e</var> = the result of <a href="https://dom.spec.whatwg.org/#concept-event-create">creating a new InputEvent</a></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-an-inputevent" id="ref-for-initialize-an-inputevent">Initialize an InputEvent</a> with <var>e</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Return <var>e</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="fire-key-input-events">
     <h3 class="heading settled" data-level="7.3" id="fire key input events"><span class="secno">7.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="fire-key-input-events">fire key input events</dfn></span><a class="self-link" href="#fire%20key%20input%20events"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>key</var>, a DOMString containing the string corresponding to the key</p>
      <dd data-md>
       <p><var>target</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget⑧">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#suppress-key-input-events-flag" id="ref-for-suppress-key-input-events-flag②">suppress key input events flag</a> is set, then</p>
       <ol>
        <li data-md>
         <p>Exit (since the keydown was canceled)</p>
       </ol>
     </ol>
     <p class="issue" id="issue-36b7f0ac"><a class="self-link" href="#issue-36b7f0ac"></a> Handle historical keypress event here</p>
     <ol>
      <li data-md>
       <p>Let <var>inputType</var> = null</p>
      <li data-md>
       <p>Let <var>data</var> = null</p>
     </ol>
     <p class="issue" id="issue-10cc14f1"><a class="self-link" href="#issue-10cc14f1"></a> How much of this can be moved into the [[Input Events]] spec?
    Issue: List more keys here</p>
     <ol>
      <li data-md>
       <p>If <var>key</var> is "Backspace", then <var>inputType</var> = "deleteContentBackward"</p>
      <li data-md>
       <p>If <var>key</var> is "Delete", then <var>inputType</var> = "deleteContentForward"</p>
      <li data-md>
       <p>Otherwise,</p>
       <ol>
        <li data-md>
         <p><var>inputType</var> = "insertText"</p>
        <li data-md>
         <p><var>data</var> = <var>key</var></p>
       </ol>
      <li data-md>
       <p>If <var>inputType</var> is not null, then</p>
       <p class="note" role="note"><span>Note:</span> Need to verify Firefox behavior.
Can be enabled by changing the "dom.input_events.beforeinput_enabled" pref in "about:config"</p>
       <ol>
        <li data-md>
         <p>Let <var>result</var> = <a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent">fire an InputEvent</a> with "beforeinput", <var>inputType</var> and <var>data</var></p>
        <li data-md>
         <p>If <var>result</var> is true</p>
         <p class="note" role="note"><span>Note:</span> Perform DOM update here. Insert key into <var>target</var> element</p>
         <p class="note" role="note"><span>Note:</span> Compat:
For insertFromPaste, Chrome has data = null, Firefox has data = same as beforeinput.</p>
        <li data-md>
         <p><a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent①">Fire an InputEvent</a> with "input", <var>inputType</var> and <var>data</var></p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="fire-an-inputevent">
     <h3 class="heading settled" data-level="7.4" id="fire an inputevent"><span class="secno">7.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="fire-an-inputevent">fire an InputEvent</dfn></span><a class="self-link" href="#fire%20an%20inputevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>inputType</var>, a DOMString containing the input event type</p>
      <dd data-md>
       <p><var>data</var>, a DOMString containing event data</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-3dc727e9"><a class="self-link" href="#issue-3dc727e9"></a> What about target ranges? Need to add support here.</p>
     <p class="issue" id="issue-616da821"><a class="self-link" href="#issue-616da821"></a> The target for input events should consider focus, but should also ensure that
    the element is editable and being modified.
    Compare: <a data-link-type="dfn" href="#fire-a-compositionevent" id="ref-for-fire-a-compositionevent">fire a compositionevent</a></p>
     <ol>
      <li data-md>
       <p>Let target = <a href="https://html.spec.whatwg.org/#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a></p>
      <li data-md>
       <p>Let <var>event</var> = result of <a data-link-type="dfn" href="#create-an-inputevent" id="ref-for-create-an-inputevent">create an InputEvent</a> with <var>eventType</var>, <var>target</var></p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-inputevent-inputtype" id="ref-for-dom-inputevent-inputtype">inputType</a></code> = <var>inputType</var></p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-inputevent-data" id="ref-for-dom-inputevent-data">data</a></code> = <var>data</var></p>
      <li data-md>
       <p>Return the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①②">dispatch</a> <var>event</var> at <var>target</var></p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="8" id="composition event"><span class="secno">8. </span><span class="content">Composition Event</span><a class="self-link" href="#composition%20event"></a></h2>
    <h3 class="heading settled" data-level="8.1" id="compositionevent-global-state"><span class="secno">8.1. </span><span class="content">Global State for CompositionEvent</span><a class="self-link" href="#compositionevent-global-state"></a></h3>
    <h4 class="heading settled" data-level="8.1.1" id="compositionevent-global-window"><span class="secno">8.1.1. </span><span class="content">Window-Level State</span><a class="self-link" href="#compositionevent-global-window"></a></h4>
    <p>The UA must maintain the following values that are shared for the Window.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="composition-mode-flag">composition mode flag</dfn> (initially false) that is set if the native
    IME is enabled and the next key press will trigger compositionstart.</p>
    <p>An <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="in-composition-flag">in composition flag</dfn> (initially false) that tracks if the system is currently
    in the middle of input composition (i.e., after <a data-link-type="dfn" href="https://www.w3.org/TR/uievents/#compositionstart" id="ref-for-compositionstart">compositionstart</a> but before <a data-link-type="dfn" href="https://www.w3.org/TR/uievents/#compositionend" id="ref-for-compositionend">compositionend</a>).</p>
    <div class="algorithm" data-algorithm="initialize-a-compositionevent">
     <h3 class="heading settled" data-level="8.2" id="initialize a compositionevent"><span class="secno">8.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-a-compositionevent">initialize a CompositionEvent</dfn></span><a class="self-link" href="#initialize%20a%20compositionevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>e</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event" id="ref-for-event④">Event</a></code> to initialize</p>
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget⑨">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-uievent" id="ref-for-initialize-a-uievent③">Initialize a UIEvent</a> with <var>e</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Initialize the following public attributes</p>
       <ol>
        <li data-md>
         <p>Set event.data = ""</p>
         <p class="note" role="note"><span>Note:</span> This attribute has the same name as an attribute in InputEvent.</p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="create-a-compositionevent">
     <h3 class="heading settled" data-level="8.3" id="create a compositionevent"><span class="secno">8.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-a-compositionevent">create a CompositionEvent</dfn></span><a class="self-link" href="#create%20a%20compositionevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget①⓪">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>e</var> = the result of <a href="https://dom.spec.whatwg.org/#concept-event-create">creating a new CompositionEvent</a></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-compositionevent" id="ref-for-initialize-a-compositionevent">Initialize a CompositionEvent</a> with <var>e</var>, <var>eventType</var> and <var>eventTarget</var></p>
      <li data-md>
       <p>Return <var>e</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="fire-a-compositionevent">
     <h3 class="heading settled" data-level="8.4" id="fire a compositionevent"><span class="secno">8.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="fire-a-compositionevent">fire a CompositionEvent</dfn></span><a class="self-link" href="#fire%20a%20compositionevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>data</var>, a DOMString containing event data</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let target = <a href="https://html.spec.whatwg.org/#currently-focused-area-of-a-top-level-browsing-context">currently focused area of a top-level browsing context</a></p>
       <p class="issue" id="issue-82843cb4"><a class="self-link" href="#issue-82843cb4"></a> The target for compositionstart should be determined by the element with
focus, but subsequent composition events should be fired on that same element.
Need to test what happens when focus changes during composition.
On the Mac, if you change focus, the composition target changes.
On Windows, behavior depends on the IME.</p>
      <li data-md>
       <p>Let <var>event</var> = result of <a data-link-type="dfn" href="#create-a-compositionevent" id="ref-for-create-a-compositionevent">create a CompositionEvent</a> with <var>eventType</var>, <var>target</var></p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#dom-compositionevent-data" id="ref-for-dom-compositionevent-data">data</a></code> = <var>data</var></p>
      <li data-md>
       <p>Return the result of <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①③">dispatch</a> <var>event</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="enter-composition-mode">
     <h3 class="heading settled" data-level="8.5" id="enter composition mode"><span class="secno">8.5. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="enter-composition-mode">enter composition mode</dfn></span><a class="self-link" href="#enter%20composition%20mode"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-35af4a5a"><a class="self-link" href="#issue-35af4a5a"></a> This is an oversimplification. We need to native OS to call then when the user
    enters composition mode.</p>
     <ol>
      <li data-md>
       <p>Set the <a data-link-type="dfn" href="#composition-mode-flag" id="ref-for-composition-mode-flag①">composition mode flag</a></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="exit-composition-mode">
     <h3 class="heading settled" data-level="8.6" id="exit composition mode"><span class="secno">8.6. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="exit-composition-mode">exit composition mode</dfn></span><a class="self-link" href="#exit%20composition%20mode"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#end-composition" id="ref-for-end-composition">End composition</a></p>
      <li data-md>
       <p>Unset the <a data-link-type="dfn" href="#composition-mode-flag" id="ref-for-composition-mode-flag②">composition mode flag</a></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-composition-key">
     <h3 class="heading settled" data-level="8.7" id="handle composition key"><span class="secno">8.7. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-composition-key">handle composition key</dfn></span><a class="self-link" href="#handle%20composition%20key"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="note" role="note"><span>Note:</span> This is called when a key is added to the composition buffer, or when the
    user navigates between composition options.</p>
     <p class="note" role="note"><span>Note:</span> This is where the IME handles the UI part to navigate the candidates or accept
    all or part of the text.
    Not sure how much (if any) of this makes sense to "specify" here since it is controlled by the IME.</p>
     <ol>
      <li data-md>
       <p>If special IME key, then</p>
      <li data-md>
       <p>If arrow, then select new candidate</p>
      <li data-md>
       <p>If enter, then accept the current candidate, run <a data-link-type="dfn" href="#end-composition" id="ref-for-end-composition①">end composition</a> and exit</p>
       <ol>
        <li data-md>
         <p>...</p>
       </ol>
     </ol>
     <p class="issue" id="issue-2d2dfa96"><a class="self-link" href="#issue-2d2dfa96"></a> Need agreement on event order for compositionupdate and beforeinput.
    Chrome currently does bi -> cu, whereas Safari does cu -> bi.
    Firefox doesn’t yet produce bi, but prefers cu -> bi.
    See <a href="https://github.com/w3c/input-events/issues/49">input-events/49</a> and <a href="https://github.com/w3c/uievents/issues/66">uievents/66</a></p>
     <ol>
      <li data-md>
       <p>Let <var>data</var> = the current composition candidate string</p>
      <li data-md>
       <p><a data-link-type="dfn" href="#fire-a-compositionevent" id="ref-for-fire-a-compositionevent①">Fire a CompositionEvent</a> with "compositionupdate" and <var>data</var></p>
       <p class="issue" id="issue-2170a384"><a class="self-link" href="#issue-2170a384"></a> Verify compositionupdate cannot be canceled</p>
      <li data-md>
       <p>Let <var>result</var> = <a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent②">fire an InputEvent</a> with "beforeinput", "insertCompositionText" and <var>data</var></p>
       <p class="issue" id="issue-8be390f6"><a class="self-link" href="#issue-8be390f6"></a> Not all beforeinput events can be canceled - need to encode that here</p>
      <li data-md>
       <p>If <var>result</var> is true, then</p>
       <ol>
        <li data-md>
         <p>Update the DOM with the composition text</p>
        <li data-md>
         <p><a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent③">Fire an InputEvent</a> with "input", "insertCompositionText" and <var>data</var></p>
         <p class="note" role="note"><span>Note:</span> Not cancelable</p>
       </ol>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="begin-composition">
     <h3 class="heading settled" data-level="8.8" id="begin composition"><span class="secno">8.8. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="begin-composition">begin composition</dfn></span><a class="self-link" href="#begin%20composition"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#in-composition-flag" id="ref-for-in-composition-flag①">in composition flag</a>, then exit</p>
      <li data-md>
       <p>Let <var>data</var> = currently selected text</p>
      <li data-md>
       <p>Let <var>result</var> = <a data-link-type="dfn" href="#fire-a-compositionevent" id="ref-for-fire-a-compositionevent②">fire a CompositionEvent</a> with "compositionstart" and <var>data</var></p>
       <p class="issue" id="issue-e3eb5b91"><a class="self-link" href="#issue-e3eb5b91"></a> Document what happens when <var>result</var> is not true (event canceled)</p>
      <li data-md>
       <p>Set <a data-link-type="dfn" href="#in-composition-flag" id="ref-for-in-composition-flag②">in composition flag</a></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#handle-composition-key" id="ref-for-handle-composition-key②">Handle composition key</a></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="end-composition">
     <h3 class="heading settled" data-level="8.9" id="end composition"><span class="secno">8.9. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="end-composition">end composition</dfn></span><a class="self-link" href="#end%20composition"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#in-composition-flag" id="ref-for-in-composition-flag③">in composition flag</a> is not set, then exit</p>
     </ol>
     <p class="issue" id="issue-271d403d"><a class="self-link" href="#issue-271d403d"></a> Compat: Chrome sends out beforeinput/compositionupdate/input sequence before
    compositionend (tested on macOS). Compare with Firefox.</p>
     <ol>
      <li data-md>
       <p>Let <var>data</var> = the current composition candidate string</p>
      <li data-md>
       <p><a data-link-type="dfn" href="#fire-a-compositionevent" id="ref-for-fire-a-compositionevent③">fire a CompositionEvent</a> with "compositionend" and <var>data</var></p>
       <p class="issue" id="issue-acf5a28c"><a class="self-link" href="#issue-acf5a28c"></a> Document what to do with result</p>
      <li data-md>
       <p>If Firefox:</p>
       <p class="issue" id="issue-273f9f41"><a class="self-link" href="#issue-273f9f41"></a> Compat: Firefox sends input events after compositionend. Not sure when the
DOM is updated relative to compositionend (tested on macOS). Need to resolve this.</p>
       <ol>
        <li data-md>
         <p><a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent④">Fire an InputEvent</a> with "input", "insertCompositionText" and <var>data</var></p>
       </ol>
      <li data-md>
       <p>Unset the <a data-link-type="dfn" href="#in-composition-flag" id="ref-for-in-composition-flag④">in composition flag</a></p>
     </ol>
    </div>
   </section>
   <h3 class="heading settled" data-level="8.10" id="pointerevent-global-state"><span class="secno">8.10. </span><span class="content">Global State for PointerEvent</span><a class="self-link" href="#pointerevent-global-state"></a></h3>
   <section>
    <h2 class="heading settled" data-level="9" id="pointer event"><span class="secno">9. </span><span class="content">Pointer Event</span><a class="self-link" href="#pointer%20event"></a></h2>
    <p class="issue" id="issue-6c0044ca"><a class="self-link" href="#issue-6c0044ca"></a> The contents of this section should eventually be moved into the PointerEvent spec.</p>
    <div class="algorithm" data-algorithm="initialize-a-pointerevent">
     <h3 class="heading settled" data-level="9.1" id="initialize a pointerevent"><span class="secno">9.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-a-pointerevent">initialize a PointerEvent</dfn></span><a class="self-link" href="#initialize%20a%20pointerevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/pointerevents3/#dom-pointerevent" id="ref-for-dom-pointerevent">PointerEvent</a></code> to initialize</p>
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>eventTarget</var>, the <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget①①">EventTarget</a></code> of the event</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-mouseevent" id="ref-for-initialize-a-mouseevent①">Initialize a MouseEvent</a> with <var>event</var>, <var>eventType</var> and <var>eventTarget</var></p>
     </ol>
     <p class="issue" id="issue-b7cb6aa8"><a class="self-link" href="#issue-b7cb6aa8"></a> TODO - initialize the pointerevent attributes</p>
    </div>
    <div class="algorithm" data-algorithm="create-pointerevent-from-mouseevent">
     <h3 class="heading settled" data-level="9.2" id="create pointerevent from mouseevent"><span class="secno">9.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="create-pointerevent-from-mouseevent">create PointerEvent from MouseEvent</dfn></span><a class="self-link" href="#create%20pointerevent%20from%20mouseevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>eventType</var>, a DOMString containing the event type</p>
      <dd data-md>
       <p><var>mouseevent</var>, the corresponding <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent⑥">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>event</var> = the result of <a href="https://dom.spec.whatwg.org/#concept-event-create">creating a new PointerEvent</a></p>
      <li data-md>
       <p>Let <var>target</var> = <var>mouseevent</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target①">target</a></code></p>
      <li data-md>
       <p><a data-link-type="dfn" href="#initialize-a-pointerevent" id="ref-for-initialize-a-pointerevent">Initialize a PointerEvent</a> with <var>event</var>, <var>eventType</var> and <var>target</var></p>
      <li data-md>
       <p>Copy MouseEvent attributes from <var>mouseevent</var> into <var>event</var></p>
      <li data-md>
       <p>Return <var>event</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="maybe-send-pointerout-event">
     <h3 class="heading settled" data-level="9.3" id="maybe send pointerout event"><span class="secno">9.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybe-send-pointerout-event">maybe send pointerout event</dfn></span><a class="self-link" href="#maybe%20send%20pointerout%20event"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>mouseout</var>, the corresponding mouseout <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent⑦">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>pointerout</var> = <a data-link-type="dfn" href="#create-pointerevent-from-mouseevent" id="ref-for-create-pointerevent-from-mouseevent">create PointerEvent from MouseEvent</a> with "pointerout" and <var>mouseout</var></p>
      <li data-md>
       <p>Set pointerevent attributes</p>
       <p class="issue" id="issue-b7b1e314①"><a class="self-link" href="#issue-b7b1e314①"></a> TODO</p>
      <li data-md>
       <p>Let <var>target</var> = <var>mouseout</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target②">target</a></code></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①④">dispatch</a> <var>pointerout</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="maybe-send-pointerleave-event">
     <h3 class="heading settled" data-level="9.4" id="maybe send pointerleave event"><span class="secno">9.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybe-send-pointerleave-event">maybe send pointerleave event</dfn></span><a class="self-link" href="#maybe%20send%20pointerleave%20event"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>mouseout</var>, the corresponding mouseout <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent⑧">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>pointerout</var> = <a data-link-type="dfn" href="#create-pointerevent-from-mouseevent" id="ref-for-create-pointerevent-from-mouseevent①">create PointerEvent from MouseEvent</a> with "pointerout" and <var>mouseout</var></p>
      <li data-md>
       <p>Set pointerevent attributes</p>
       <p class="issue" id="issue-b7b1e314②"><a class="self-link" href="#issue-b7b1e314②"></a> TODO</p>
      <li data-md>
       <p>Let <var>target</var> = <var>mouseout</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target③">target</a></code></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①⑤">dispatch</a> <var>pointerout</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="maybe-send-pointerover-event">
     <h3 class="heading settled" data-level="9.5" id="maybe send pointerover event"><span class="secno">9.5. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybe-send-pointerover-event">maybe send pointerover event</dfn></span><a class="self-link" href="#maybe%20send%20pointerover%20event"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>mouseout</var>, the corresponding mouseout <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent⑨">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>pointerout</var> = <a data-link-type="dfn" href="#create-pointerevent-from-mouseevent" id="ref-for-create-pointerevent-from-mouseevent②">create PointerEvent from MouseEvent</a> with "pointerout" and <var>mouseout</var></p>
      <li data-md>
       <p>Set pointerevent attributes</p>
       <p class="issue" id="issue-b7b1e314③"><a class="self-link" href="#issue-b7b1e314③"></a> TODO</p>
      <li data-md>
       <p>Let <var>target</var> = <var>mouseout</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target④">target</a></code></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①⑥">dispatch</a> <var>pointerout</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="maybe-send-pointerenter-event">
     <h3 class="heading settled" data-level="9.6" id="maybe send pointerenter event"><span class="secno">9.6. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybe-send-pointerenter-event">maybe send pointerenter event</dfn></span><a class="self-link" href="#maybe%20send%20pointerenter%20event"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>mouseout</var>, the corresponding mouseout <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①⓪">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>pointerout</var> = <a data-link-type="dfn" href="#create-pointerevent-from-mouseevent" id="ref-for-create-pointerevent-from-mouseevent③">create PointerEvent from MouseEvent</a> with "pointerout" and <var>mouseout</var></p>
      <li data-md>
       <p>Set pointerevent attributes</p>
       <p class="issue" id="issue-b7b1e314④"><a class="self-link" href="#issue-b7b1e314④"></a> TODO</p>
      <li data-md>
       <p>Let <var>target</var> = <var>mouseout</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target⑤">target</a></code></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①⑦">dispatch</a> <var>pointerout</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="maybe-send-pointermove-event">
     <h3 class="heading settled" data-level="9.7" id="maybe send pointermove event"><span class="secno">9.7. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybe-send-pointermove-event">maybe send pointermove event</dfn></span><a class="self-link" href="#maybe%20send%20pointermove%20event"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>mouseout</var>, the corresponding mouseout <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①①">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-db237ad4"><a class="self-link" href="#issue-db237ad4"></a> Can this send pointermove and pointerrawupdate? Or do we need 2 methods?</p>
     <p class="issue" id="issue-a521983e"><a class="self-link" href="#issue-a521983e"></a> What is needed to properly define how pointermove events are coalesced?</p>
     <ol>
      <li data-md>
       <p>Let <var>pointerout</var> = <a data-link-type="dfn" href="#create-pointerevent-from-mouseevent" id="ref-for-create-pointerevent-from-mouseevent④">create PointerEvent from MouseEvent</a> with "pointerout" and <var>mouseout</var></p>
      <li data-md>
       <p>Set pointerevent attributes</p>
       <p class="issue" id="issue-b7b1e314⑤"><a class="self-link" href="#issue-b7b1e314⑤"></a> TODO</p>
      <li data-md>
       <p>Let <var>target</var> = <var>mouseout</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target⑥">target</a></code></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①⑧">dispatch</a> <var>pointerout</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="maybe-send-pointerdown-event">
     <h3 class="heading settled" data-level="9.8" id="maybe send pointerdown event"><span class="secno">9.8. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybe-send-pointerdown-event">maybe send pointerdown event</dfn></span><a class="self-link" href="#maybe%20send%20pointerdown%20event"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>mouseout</var>, the corresponding mouseout <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①②">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-ac02e1f6"><a class="self-link" href="#issue-ac02e1f6"></a> Unlike mousedown events, <a href="https://w3c.github.io/pointerevents/#the-pointerdown-event">pointerdown</a> events are not nested when multiple buttons are pressed.
    The MouseEvent is passed so that the fields can be copied into the PointerEvent.</p>
     <ol>
      <li data-md>
       <p>Let <var>pointerout</var> = <a data-link-type="dfn" href="#create-pointerevent-from-mouseevent" id="ref-for-create-pointerevent-from-mouseevent⑤">create PointerEvent from MouseEvent</a> with "pointerout" and <var>mouseout</var></p>
      <li data-md>
       <p>Set pointerevent attributes</p>
       <p class="issue" id="issue-b7b1e314⑥"><a class="self-link" href="#issue-b7b1e314⑥"></a> TODO</p>
      <li data-md>
       <p>Let <var>target</var> = <var>mouseout</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target⑦">target</a></code></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch①⑨">dispatch</a> <var>pointerout</var> at <var>target</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="maybe-send-pointerup-event">
     <h3 class="heading settled" data-level="9.9" id="maybe send pointerup event"><span class="secno">9.9. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybe-send-pointerup-event">maybe send pointerup event</dfn></span><a class="self-link" href="#maybe%20send%20pointerup%20event"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>mouseout</var>, the corresponding mouseout <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①③">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-571ee343"><a class="self-link" href="#issue-571ee343"></a> Unlike mouseup events, <a href="https://w3c.github.io/pointerevents/#the-pointerup-event">pointerup</a> events are not nested when multiple buttons are pressed.
    The MouseEvent is passed so that the fields can be copied into the PointerEvent.</p>
     <ol>
      <li data-md>
       <p>Let <var>pointerout</var> = <a data-link-type="dfn" href="#create-pointerevent-from-mouseevent" id="ref-for-create-pointerevent-from-mouseevent⑥">create PointerEvent from MouseEvent</a> with "pointerout" and <var>mouseout</var></p>
      <li data-md>
       <p>Set pointerevent attributes</p>
       <p class="issue" id="issue-b7b1e314⑦"><a class="self-link" href="#issue-b7b1e314⑦"></a> TODO</p>
      <li data-md>
       <p>Let <var>target</var> = <var>mouseout</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-target" id="ref-for-dom-event-target⑧">target</a></code></p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-dispatch" id="ref-for-concept-event-dispatch②⓪">dispatch</a> <var>pointerout</var> at <var>target</var></p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="10" id="pointer lock"><span class="secno">10. </span><span class="content">Pointer Lock</span><a class="self-link" href="#pointer%20lock"></a></h2>
    <p class="issue" id="issue-972fa7f3"><a class="self-link" href="#issue-972fa7f3"></a> The contents of this section should eventually be moved into the <a data-link-type="biblio" href="#biblio-pointerlock">[PointerLock]</a> spec</p>
    <p class="note" role="note"><span>Note:</span> The algorithms here are an oversimplification since they don’t account for the lock/unlock
state the or the pointer leaving and re-entering the UA screen boundaries.
That should be fixed as part of moving this section to the PointerLock spec.</p>
    <h3 class="heading settled" data-level="10.1" id="pointerlock-interface"><span class="secno">10.1. </span><span class="content">MouseEvent Interface Extension</span><a class="self-link" href="#pointerlock-interface"></a></h3>
    <p>A <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①④">MouseEvent</a></code> has the following:</p>
    <dl>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-movementx"><code>movementX</code></dfn>
     <li><dfn class="dfn-paneled idl-code" data-dfn-for="MouseEvent" data-dfn-type="attribute" data-export id="dom-mouseevent-movementy"><code>movementY</code></dfn>
    </dl>
    <h3 class="heading settled" data-level="10.2" id="pointer-lock-global-state"><span class="secno">10.2. </span><span class="content">Global State for PointerLock</span><a class="self-link" href="#pointer-lock-global-state"></a></h3>
    <h4 class="heading settled" data-level="10.2.1" id="pointer-lock-global-window"><span class="secno">10.2.1. </span><span class="content">Window-Level State</span><a class="self-link" href="#pointer-lock-global-window"></a></h4>
    <p>The UA must maintain the following values that are shared for the Window.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="last-mouse-move">last mouse move</dfn> value (initially undefined) that records the position of the
    last mousemove event.</p>
    <div class="algorithm" data-algorithm="initialize-pointerlock-attributes-for-mouseevent">
     <h3 class="heading settled" data-level="10.3" id="initialize pointerlock attributes for mouseevent"><span class="secno">10.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-pointerlock-attributes-for-mouseevent">initialize PointerLock attributes for MouseEvent</dfn></span><a class="self-link" href="#initialize%20pointerlock%20attributes%20for%20mouseevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①⑤">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-movementx" id="ref-for-dom-mouseevent-movementx">movementX</a></code> = 0</p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-movementy" id="ref-for-dom-mouseevent-movementy">movementY</a></code> = 0</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="set-pointerlock-attributes-for-mousemove">
     <h3 class="heading settled" data-level="10.4" id="set pointerlock attributes for mousemove"><span class="secno">10.4. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-pointerlock-attributes-for-mousemove">set PointerLock attributes for mousemove</dfn></span><a class="self-link" href="#set%20pointerlock%20attributes%20for%20mousemove"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①⑥">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>If <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#dom-event-type" id="ref-for-dom-event-type②">type</a></code> is not "mousemove", then exit</p>
      <li data-md>
       <p>If <a data-link-type="dfn" href="#last-mouse-move" id="ref-for-last-mouse-move">last mouse move</a> is not defined, then</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-movementx" id="ref-for-dom-mouseevent-movementx①">movementX</a></code> = 0</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-movementy" id="ref-for-dom-mouseevent-movementy①">movementY</a></code> = 0</p>
       </ol>
      <li data-md>
       <p>Otherwise,</p>
       <ol>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-movementx" id="ref-for-dom-mouseevent-movementx②">movementX</a></code> = <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-screenx" id="ref-for-dom-mouseevent-screenx①">screenX</a></code> - <a data-link-type="dfn" href="#last-mouse-move" id="ref-for-last-mouse-move①">last mouse move</a>’s x-coordinate</p>
        <li data-md>
         <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-movementy" id="ref-for-dom-mouseevent-movementy②">movementY</a></code> = <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-screenx" id="ref-for-dom-mouseevent-screenx②">screenX</a></code> - <a data-link-type="dfn" href="#last-mouse-move" id="ref-for-last-mouse-move②">last mouse move</a>’s y-coordinate</p>
       </ol>
      <li data-md>
       <p>Set <a data-link-type="dfn" href="#last-mouse-move" id="ref-for-last-mouse-move③">last mouse move</a> = ( <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-screenx" id="ref-for-dom-mouseevent-screenx③">screenX</a></code>, <var>event</var>.<code class="idl"><a data-link-type="idl" href="#dom-mouseevent-screeny" id="ref-for-dom-mouseevent-screeny①">screenY</a></code> )</p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="11" id="keyboard lock"><span class="secno">11. </span><span class="content">Keyboard Lock</span><a class="self-link" href="#keyboard%20lock"></a></h2>
    <p class="issue" id="issue-37fef50b"><a class="self-link" href="#issue-37fef50b"></a> KeyboardLock is not yet an accepted standard and is included here as a placeholder
to explore how it might be integrated.</p>
    <p class="issue" id="issue-e74af8f5"><a class="self-link" href="#issue-e74af8f5"></a> The contents of this section should eventually be moved into the [[WICG Keyboard Lock]] spec</p>
    <h3 class="heading settled" data-level="11.1" id="keyboard-lock-global-state"><span class="secno">11.1. </span><span class="content">Global State for Keyboard Lock</span><a class="self-link" href="#keyboard-lock-global-state"></a></h3>
    <h4 class="heading settled" data-level="11.1.1" id="keyboard-lock-global-ua"><span class="secno">11.1.1. </span><span class="content">User Agent-Level State</span><a class="self-link" href="#keyboard-lock-global-ua"></a></h4>
    <p>The UA must maintain the following values that are shared for the entire
    User Agent.</p>
    <p class="issue" id="issue-b7b1e314⑧"><a class="self-link" href="#issue-b7b1e314⑧"></a> TODO</p>
    <h4 class="heading settled" data-level="11.1.2" id="keyboard-lock-global-window"><span class="secno">11.1.2. </span><span class="content">Window-Level State</span><a class="self-link" href="#keyboard-lock-global-window"></a></h4>
    <p>The UA must maintain the following values that are shared for the Window.</p>
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="keyboard-lock-enable-flag">keyboard lock enable flag</dfn> (initially false) that tracks whether Keyboard
    Lock is currently enabled.</p>
    <div class="algorithm" data-algorithm="keyboard-lock-is-enabled">
     <h3 class="heading settled" data-level="11.2" id="keyboard lock is enabled"><span class="secno">11.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="keyboard-lock-is-enabled">Keyboard Lock is enabled</dfn></span><a class="self-link" href="#keyboard%20lock%20is%20enabled"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>True if keyboard lock is enabled.</p>
     </dl>
     <ol>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="#keyboard-lock-enable-flag" id="ref-for-keyboard-lock-enable-flag">keyboard lock enable flag</a></p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="12" id="core dom"><span class="secno">12. </span><span class="content">Core DOM</span><a class="self-link" href="#core%20dom"></a></h2>
    <p class="issue" id="issue-65045046"><a class="self-link" href="#issue-65045046"></a> These definitions probably belong in another spec.</p>
    <div class="algorithm" data-algorithm="hit-test">
     <h3 class="heading settled" data-level="12.1" id="hit test"><span class="secno">12.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="hit-test">hit test</dfn></span><a class="self-link" href="#hit%20test"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>pos</var>, the x,y coordinates relative to the viewport</p>
      <dt data-md>Output
      <dd data-md>
       <p>The frontmost DOM element at <var>pos</var></p>
     </dl>
     <p class="issue" id="issue-d31c8856"><a class="self-link" href="#issue-d31c8856"></a> To account for <a href="https://html.spec.whatwg.org/#inert">inert</a> or <a href="https://html.spec.whatwg.org/#concept-fe-disabled">disabled</a> elements. this should call <a data-link-type="dfn" href="https://www.w3.org/TR/cssom-view-1/#dom-document-elementfrompoint" id="ref-for-dom-document-elementfrompoint">elementsFromPoint</a> and reject
    invalid elements</p>
     <ol>
      <li data-md>
       <p>Return <a data-link-type="biblio" href="#biblio-cssom-view">[CSSOM-View]</a>'s <a data-link-type="dfn" href="https://www.w3.org/TR/cssom-view-1/#dom-document-elementfrompoint" id="ref-for-dom-document-elementfrompoint①">elementFromPoint</a> with <var>pos</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="calculate-dom-path">
     <h3 class="heading settled" data-level="12.2" id="calculate dom path"><span class="secno">12.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="calculate-dom-path">calculate DOM path</dfn></span><a class="self-link" href="#calculate%20dom%20path"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>element</var>, the starting element</p>
      <dt data-md>Output
      <dd data-md>
       <p>The list of ancestor elements for the given element</p>
     </dl>
     <ol>
      <li data-md>
       <p>Let <var>path</var> = A list that contains <var>element</var></p>
     </ol>
     <p class="issue" id="issue-b8797d0c"><a class="self-link" href="#issue-b8797d0c"></a> This needs a proper definition to add ancestors to <var>path</var>.</p>
     <ol>
      <li data-md>
       <p>Return <var>path</var></p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="13" id="cssom"><span class="secno">13. </span><span class="content">CSSOM</span><a class="self-link" href="#cssom"></a></h2>
    <p class="issue" id="issue-2236bbea"><a class="self-link" href="#issue-2236bbea"></a> The contents of this section should eventually be moved into the <a data-link-type="biblio" href="#biblio-cssom">[CSSOM]</a> spec</p>
    <div class="algorithm" data-algorithm="initialize-cssom-attributes-for-mouseevent">
     <h3 class="heading settled" data-level="13.1" id="initialize cssom attributes for mouseevent"><span class="secno">13.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="initialize-cssom-attributes-for-mouseevent">initialize CSSOM attributes for MouseEvent</dfn></span><a class="self-link" href="#initialize%20cssom%20attributes%20for%20mouseevent"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p><var>event</var>, a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/uievents/#mouseevent" id="ref-for-mouseevent①⑦">MouseEvent</a></code></p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <ol>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-pagex" id="ref-for-dom-mouseevent-pagex">pageX</a></code> according to <a href="https://www.w3.org/TR/cssom-view-1/#dom-mouseevent-pagex">pageX</a></p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-pagey" id="ref-for-dom-mouseevent-pagey">pageY</a></code> according to <a href="https://www.w3.org/TR/cssom-view-1/#dom-mouseevent-pagey">pageY</a></p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-x" id="ref-for-dom-mouseevent-x">x</a></code> according to <a href="https://www.w3.org/TR/cssom-view-1/#dom-mouseevent-x">x</a></p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-y" id="ref-for-dom-mouseevent-y">y</a></code> according to <a href="https://www.w3.org/TR/cssom-view-1/#dom-mouseevent-y">y</a></p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-offsetx" id="ref-for-dom-mouseevent-offsetx">offsetX</a></code> according to <a href="https://www.w3.org/TR/cssom-view-1/#dom-mouseevent-offsetx">offsetX</a></p>
      <li data-md>
       <p>Set <var>event</var>.<code class="idl"><a data-link-type="idl" href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-offsety" id="ref-for-dom-mouseevent-offsety">offsetY</a></code> according to <a href="https://www.w3.org/TR/cssom-view-1/#dom-mouseevent-offsety">offsetY</a></p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="14" id="clipboard"><span class="secno">14. </span><span class="content">Clipboard</span><a class="self-link" href="#clipboard"></a></h2>
    <p class="issue" id="issue-5ce38960"><a class="self-link" href="#issue-5ce38960"></a> Should these be moved into the Clipboard spec?</p>
    <div class="algorithm" data-algorithm="handle-native-cut">
     <h3 class="heading settled" data-level="14.1" id="handle native cut"><span class="secno">14.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-cut">handle native cut</dfn></span><a class="self-link" href="#handle%20native%20cut"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="issue" id="issue-86dbc66c"><a class="self-link" href="#issue-86dbc66c"></a> Define when the "cut" event is fired.</p>
     <ol>
      <li data-md>
       <p>Let <var>data</var> = null</p>
      <li data-md>
       <p>Let <var>result</var> = <a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent⑤">fire an InputEvent</a> with "beforeinput", "deleteByCut" and <var>data</var></p>
      <li data-md>
       <p>If <var>result</var> is true, then</p>
      <li data-md>
       <p>Copy selected text to clipboard</p>
      <li data-md>
       <p>Remove selected text from DOM target element</p>
      <li data-md>
       <p><a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent⑥">Fire an InputEvent</a> with "input", "deleteByCut" and <var>data</var></p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-copy">
     <h3 class="heading settled" data-level="14.2" id="handle native copy"><span class="secno">14.2. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-copy">handle native copy</dfn></span><a class="self-link" href="#handle%20native%20copy"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="note" role="note"><span>Note:</span> No input events fired</p>
     <p class="issue" id="issue-4a872fb7"><a class="self-link" href="#issue-4a872fb7"></a> Define when "copy" event is fired. Should that be in the Clipboard Spec?</p>
     <ol>
      <li data-md>
       <p>Update clipboard with current selection</p>
     </ol>
    </div>
    <div class="algorithm" data-algorithm="handle-native-paste">
     <h3 class="heading settled" data-level="14.3" id="handle native paste"><span class="secno">14.3. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handle-native-paste">handle native paste</dfn></span><a class="self-link" href="#handle%20native%20paste"></a></h3>
     <dl>
      <dt data-md>Input
      <dd data-md>
       <p>None</p>
      <dt data-md>Output
      <dd data-md>
       <p>None</p>
     </dl>
     <p class="note" role="note"><span>Note:</span> This is intended to be called when the UA triggers a paste action (via user action)</p>
     <p class="issue" id="issue-c9eb8a10"><a class="self-link" href="#issue-c9eb8a10"></a> Define when the "paste" event is fired.</p>
     <ol>
      <li data-md>
       <p>Let <var>data</var> = the text on the clipboard being pasted</p>
      <li data-md>
       <p>Let <var>result</var> = <a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent⑦">fire an InputEvent</a> with "beforeinput", "insertFromPaste" and <var>data</var></p>
      <li data-md>
       <p>If <var>result</var> is true, then</p>
      <li data-md>
       <p>Paste clipboard contents into DOM target element</p>
      <li data-md>
       <p><a data-link-type="dfn" href="#fire-an-inputevent" id="ref-for-fire-an-inputevent⑧">Fire an InputEvent</a> with "input", "insertFromPaste" and <var>data</var></p>
     </ol>
    </div>
   </section>
   <section>
    <h2 class="heading settled" data-level="15" id="acknowledgementsclipboard"><span class="secno">15. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgementsclipboard"></a></h2>
    <p>Thanks to the following for their contributions to this document:</p>
    <ul>
     <li data-md>
      <p>Anupam Snigdha</p>
     <li data-md>
      <p>Domenic Denicola</p>
     <li data-md>
      <p>Masayuki Nakano</p>
    </ul>
   </section>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#keyboardevent-alt-flag">alt flag</a><span>, in §6.1</span>
   <li><a href="#keyboardevent-altgraph-flag">altgraph flag</a><span>, in §6.1</span>
   <li>
    altKey
    <ul>
     <li><a href="#dom-keyboardevent-altkey">attribute for KeyboardEvent</a><span>, in §6.1</span>
     <li><a href="#dom-mouseevent-altkey">attribute for MouseEvent</a><span>, in §5.1</span>
    </ul>
   <li><a href="#begin-composition">begin composition</a><span>, in §8.8</span>
   <li><a href="#dom-mouseevent-button">button</a><span>, in §5.1</span>
   <li><a href="#dom-mouseevent-buttons">buttons</a><span>, in §5.1</span>
   <li><a href="#calculate-dom-path">calculate DOM path</a><span>, in §12.2</span>
   <li><a href="#calculate-key-location">calculate key location</a><span>, in §6.7</span>
   <li><a href="#calculate-mouseevent-button-attribute">calculate MouseEvent button attribute</a><span>, in §5.5</span>
   <li><a href="#keyboardevent-capslock-flag">capslock flag</a><span>, in §6.1</span>
   <li><a href="#dom-mouseevent-clientx">clientX</a><span>, in §5.1</span>
   <li><a href="#dom-mouseevent-clienty">clientY</a><span>, in §5.1</span>
   <li><a href="#dom-keyboardevent-code">code</a><span>, in §6.1</span>
   <li><a href="#composition-mode-flag">composition mode flag</a><span>, in §8.1.1</span>
   <li><a href="#keyboardevent-control-flag">control flag</a><span>, in §6.1</span>
   <li><a href="#create-a-compositionevent">create a CompositionEvent</a><span>, in §8.3</span>
   <li><a href="#create-a-keyboardevent">create a KeyboardEvent</a><span>, in §6.4</span>
   <li><a href="#create-a-mouseevent">create a MouseEvent</a><span>, in §5.4</span>
   <li><a href="#create-an-inputevent">create an InputEvent</a><span>, in §7.2</span>
   <li><a href="#create-pointerevent-from-mouseevent">create PointerEvent from MouseEvent</a><span>, in §9.2</span>
   <li>
    ctrlKey
    <ul>
     <li><a href="#dom-keyboardevent-ctrlkey">attribute for KeyboardEvent</a><span>, in §6.1</span>
     <li><a href="#dom-mouseevent-ctrlkey">attribute for MouseEvent</a><span>, in §5.1</span>
    </ul>
   <li><a href="#dom-uievent-detail">detail</a><span>, in §4.1</span>
   <li><a href="#dom-keyboardevent-dom_key_location_left">DOM_KEY_LOCATION_LEFT</a><span>, in §6.1</span>
   <li><a href="#dom-keyboardevent-dom_key_location_numpad">DOM_KEY_LOCATION_NUMPAD</a><span>, in §6.1</span>
   <li><a href="#dom-keyboardevent-dom_key_location_right">DOM_KEY_LOCATION_RIGHT</a><span>, in §6.1</span>
   <li><a href="#dom-keyboardevent-dom_key_location_standard">DOM_KEY_LOCATION_STANDARD</a><span>, in §6.1</span>
   <li><a href="#uievent-due-to-user-interaction-flag">due to user interaction flag</a><span>, in §3.1</span>
   <li><a href="#end-composition">end composition</a><span>, in §8.9</span>
   <li><a href="#enter-composition-mode">enter composition mode</a><span>, in §8.5</span>
   <li><a href="#exit-composition-mode">exit composition mode</a><span>, in §8.6</span>
   <li><a href="#fire-a-compositionevent">fire a CompositionEvent</a><span>, in §8.4</span>
   <li><a href="#fire-an-inputevent">fire an InputEvent</a><span>, in §7.4</span>
   <li><a href="#fire-key-input-events">fire key input events</a><span>, in §7.3</span>
   <li><a href="#get-modifier-state">get modifier state</a><span>, in §6.8</span>
   <li><a href="#handle-composition-key">handle composition key</a><span>, in §8.7</span>
   <li><a href="#handle-native-copy">handle native copy</a><span>, in §14.2</span>
   <li><a href="#handle-native-cut">handle native cut</a><span>, in §14.1</span>
   <li><a href="#handle-native-key-down">handle native key down</a><span>, in §6.11</span>
   <li><a href="#handle-native-key-press">handle native key press</a><span>, in §6.13</span>
   <li><a href="#handle-native-key-up">handle native key up</a><span>, in §6.12</span>
   <li><a href="#handle-native-mouse-click">handle native mouse click</a><span>, in §5.9</span>
   <li><a href="#handle-native-mouse-double-click">handle native mouse double click</a><span>, in §5.10</span>
   <li><a href="#handle-native-mouse-down">handle native mouse down</a><span>, in §5.7</span>
   <li><a href="#handle-native-mouse-move">handle native mouse move</a><span>, in §5.11</span>
   <li><a href="#handle-native-mouse-up">handle native mouse up</a><span>, in §5.8</span>
   <li><a href="#handle-native-paste">handle native paste</a><span>, in §14.3</span>
   <li><a href="#handle-post-browser-key">handle post browser key</a><span>, in §6.10</span>
   <li><a href="#handle-pre-browser-key">handle pre browser key</a><span>, in §6.9</span>
   <li><a href="#hit-test">hit test</a><span>, in §12.1</span>
   <li><a href="#in-composition-flag">in composition flag</a><span>, in §8.1.1</span>
   <li><a href="#initialize-a-compositionevent">initialize a CompositionEvent</a><span>, in §8.2</span>
   <li><a href="#initialize-a-keyboardevent">initialize a KeyboardEvent</a><span>, in §6.3</span>
   <li><a href="#initialize-a-mouseevent">initialize a MouseEvent</a><span>, in §5.3</span>
   <li><a href="#initialize-an-event">initialize an Event</a><span>, in §3.2</span>
   <li><a href="#initialize-an-inputevent">initialize an InputEvent</a><span>, in §7.1</span>
   <li><a href="#initialize-a-pointerevent">initialize a PointerEvent</a><span>, in §9.1</span>
   <li><a href="#initialize-a-uievent">initialize a UIEvent</a><span>, in §4.2</span>
   <li><a href="#initialize-cssom-attributes-for-mouseevent">initialize CSSOM attributes for MouseEvent</a><span>, in §13.1</span>
   <li><a href="#initialize-pointerlock-attributes-for-mouseevent">initialize PointerLock attributes for MouseEvent</a><span>, in §10.3</span>
   <li><a href="#dom-keyboardevent-iscomposing">isComposing</a><span>, in §6.1</span>
   <li><a href="#dom-keyboardevent-key">key</a><span>, in §6.1</span>
   <li><a href="#keyboard-lock-enable-flag">keyboard lock enable flag</a><span>, in §11.1.2</span>
   <li><a href="#keyboard-lock-is-enabled">Keyboard Lock is enabled</a><span>, in §11.2</span>
   <li><a href="#dom-keyboardevent-keychar">keyChar</a><span>, in §6.1</span>
   <li><a href="#dom-keyboardevent-keycode">keyCode</a><span>, in §6.1</span>
   <li><a href="#key-modifier-state">key modifier state</a><span>, in §6.2.1</span>
   <li><a href="#last-mouse-dom-path">last mouse DOM path</a><span>, in §5.2.2</span>
   <li><a href="#last-mouse-element">last mouse element</a><span>, in §5.2.2</span>
   <li><a href="#last-mouse-move">last mouse move</a><span>, in §10.2.1</span>
   <li><a href="#dom-keyboardevent-location">location</a><span>, in §6.1</span>
   <li><a href="#maybe-send-pointerdown-event">maybe send pointerdown event</a><span>, in §9.8</span>
   <li><a href="#maybe-send-pointerenter-event">maybe send pointerenter event</a><span>, in §9.6</span>
   <li><a href="#maybe-send-pointerleave-event">maybe send pointerleave event</a><span>, in §9.4</span>
   <li><a href="#maybe-send-pointermove-event">maybe send pointermove event</a><span>, in §9.7</span>
   <li><a href="#maybe-send-pointerout-event">maybe send pointerout event</a><span>, in §9.3</span>
   <li><a href="#maybe-send-pointerover-event">maybe send pointerover event</a><span>, in §9.5</span>
   <li><a href="#maybe-send-pointerup-event">maybe send pointerup event</a><span>, in §9.9</span>
   <li><a href="#keyboardevent-meta-flag">meta flag</a><span>, in §6.1</span>
   <li>
    metaKey
    <ul>
     <li><a href="#dom-keyboardevent-metakey">attribute for KeyboardEvent</a><span>, in §6.1</span>
     <li><a href="#dom-mouseevent-metakey">attribute for MouseEvent</a><span>, in §5.1</span>
    </ul>
   <li><a href="#mouse-button-bitmask">mouse button bitmask</a><span>, in §5.2.1</span>
   <li><a href="#dom-mouseevent-movementx">movementX</a><span>, in §10.1</span>
   <li><a href="#dom-mouseevent-movementy">movementY</a><span>, in §10.1</span>
   <li><a href="#keyboardevent-numlock-flag">numlock flag</a><span>, in §6.1</span>
   <li><a href="#dom-mouseevent-relatedtarget">relatedTarget</a><span>, in §5.1</span>
   <li><a href="#dom-keyboardevent-repeat">repeat</a><span>, in §6.1</span>
   <li><a href="#dom-mouseevent-screenx">screenX</a><span>, in §5.1</span>
   <li><a href="#dom-mouseevent-screeny">screenY</a><span>, in §5.1</span>
   <li><a href="#set-event-modifiers">set event modifiers</a><span>, in §6.5</span>
   <li><a href="#set-keyboardevent-attributes">set KeyboardEvent attributes</a><span>, in §6.6</span>
   <li><a href="#set-mouseevent-attributes-from-native">set MouseEvent attributes from native</a><span>, in §5.6</span>
   <li><a href="#set-pointerlock-attributes-for-mousemove">set PointerLock attributes for mousemove</a><span>, in §10.4</span>
   <li><a href="#keyboardevent-shift-flag">shift flag</a><span>, in §6.1</span>
   <li>
    shiftKey
    <ul>
     <li><a href="#dom-keyboardevent-shiftkey">attribute for KeyboardEvent</a><span>, in §6.1</span>
     <li><a href="#dom-mouseevent-shiftkey">attribute for MouseEvent</a><span>, in §5.1</span>
    </ul>
   <li><a href="#suppress-key-input-events-flag">suppress key input events flag</a><span>, in §6.2.2</span>
   <li><a href="#dom-uievent-view">view</a><span>, in §4.1</span>
   <li><a href="#dom-keyboardevent-which">which</a><span>, in §4.1</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-viewport">
   <a href="https://www.w3.org/TR/CSS2/visuren.html#viewport">https://www.w3.org/TR/CSS2/visuren.html#viewport</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-viewport">5.3. initialize a MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-document-elementfrompoint">
   <a href="https://www.w3.org/TR/cssom-view-1/#dom-document-elementfrompoint">https://www.w3.org/TR/cssom-view-1/#dom-document-elementfrompoint</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-elementfrompoint">12.1. hit test</a> <a href="#ref-for-dom-document-elementfrompoint①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-document-elementfrompoint">
   <a href="https://www.w3.org/TR/cssom-view-1/#dom-document-elementfrompoint">https://www.w3.org/TR/cssom-view-1/#dom-document-elementfrompoint</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-document-elementfrompoint">12.1. hit test</a> <a href="#ref-for-dom-document-elementfrompoint①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mouseevent-offsetx">
   <a href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-offsetx">https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-offsetx</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-offsetx">13.1. initialize CSSOM attributes for MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mouseevent-offsety">
   <a href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-offsety">https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-offsety</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-offsety">13.1. initialize CSSOM attributes for MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mouseevent-pagex">
   <a href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-pagex">https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-pagex</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-pagex">13.1. initialize CSSOM attributes for MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mouseevent-pagey">
   <a href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-pagey">https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-pagey</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-pagey">13.1. initialize CSSOM attributes for MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mouseevent-x">
   <a href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-x">https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-x</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-x">13.1. initialize CSSOM attributes for MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mouseevent-y">
   <a href="https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-y">https://drafts.csswg.org/cssom-view-1/#dom-mouseevent-y</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-y">13.1. initialize CSSOM attributes for MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-element">
   <a href="https://dom.spec.whatwg.org/#element">https://dom.spec.whatwg.org/#element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-element">5.2.2. Window-Level State</a> <a href="#ref-for-element①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event">
   <a href="https://dom.spec.whatwg.org/#event">https://dom.spec.whatwg.org/#event</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event">3. Event</a>
    <li><a href="#ref-for-event①">3.1. Event Interface</a>
    <li><a href="#ref-for-event②">3.2. initialize an Event</a>
    <li><a href="#ref-for-event③">7.1. initialize an InputEvent</a>
    <li><a href="#ref-for-event④">8.2. initialize a CompositionEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventtarget">
   <a href="https://dom.spec.whatwg.org/#eventtarget">https://dom.spec.whatwg.org/#eventtarget</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventtarget">3.2. initialize an Event</a>
    <li><a href="#ref-for-eventtarget①">4.2. initialize a UIEvent</a>
    <li><a href="#ref-for-eventtarget②">5.3. initialize a MouseEvent</a>
    <li><a href="#ref-for-eventtarget③">5.4. create a MouseEvent</a>
    <li><a href="#ref-for-eventtarget④">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-eventtarget⑤">6.4. create a KeyboardEvent</a>
    <li><a href="#ref-for-eventtarget⑥">7.1. initialize an InputEvent</a>
    <li><a href="#ref-for-eventtarget⑦">7.2. create an InputEvent</a>
    <li><a href="#ref-for-eventtarget⑧">7.3. fire key input events</a>
    <li><a href="#ref-for-eventtarget⑨">8.2. initialize a CompositionEvent</a>
    <li><a href="#ref-for-eventtarget①⓪">8.3. create a CompositionEvent</a>
    <li><a href="#ref-for-eventtarget①①">9.1. initialize a PointerEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-none">
   <a href="https://dom.spec.whatwg.org/#dom-event-none">https://dom.spec.whatwg.org/#dom-event-none</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-none">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-bubbles">
   <a href="https://dom.spec.whatwg.org/#dom-event-bubbles">https://dom.spec.whatwg.org/#dom-event-bubbles</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-bubbles">3.2. initialize an Event</a>
    <li><a href="#ref-for-dom-event-bubbles①">5.11. handle native mouse move</a> <a href="#ref-for-dom-event-bubbles②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-cancelable">
   <a href="https://dom.spec.whatwg.org/#dom-event-cancelable">https://dom.spec.whatwg.org/#dom-event-cancelable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-cancelable">3.2. initialize an Event</a>
    <li><a href="#ref-for-dom-event-cancelable①">5.11. handle native mouse move</a> <a href="#ref-for-dom-event-cancelable②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-canceled-flag">
   <a href="https://dom.spec.whatwg.org/#canceled-flag">https://dom.spec.whatwg.org/#canceled-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-canceled-flag">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-composed">
   <a href="https://dom.spec.whatwg.org/#dom-event-composed">https://dom.spec.whatwg.org/#dom-event-composed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-composed">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-composed-flag">
   <a href="https://dom.spec.whatwg.org/#composed-flag">https://dom.spec.whatwg.org/#composed-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-composed-flag">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-currenttarget">
   <a href="https://dom.spec.whatwg.org/#dom-event-currenttarget">https://dom.spec.whatwg.org/#dom-event-currenttarget</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-currenttarget">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-defaultprevented">
   <a href="https://dom.spec.whatwg.org/#dom-event-defaultprevented">https://dom.spec.whatwg.org/#dom-event-defaultprevented</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-defaultprevented">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dispatch-flag">
   <a href="https://dom.spec.whatwg.org/#dispatch-flag">https://dom.spec.whatwg.org/#dispatch-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dispatch-flag">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-eventphase">
   <a href="https://dom.spec.whatwg.org/#dom-event-eventphase">https://dom.spec.whatwg.org/#dom-event-eventphase</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-eventphase">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-passive-listener-flag">
   <a href="https://dom.spec.whatwg.org/#in-passive-listener-flag">https://dom.spec.whatwg.org/#in-passive-listener-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-passive-listener-flag">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-initialized-flag">
   <a href="https://dom.spec.whatwg.org/#initialized-flag">https://dom.spec.whatwg.org/#initialized-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialized-flag">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-istrusted">
   <a href="https://dom.spec.whatwg.org/#dom-event-istrusted">https://dom.spec.whatwg.org/#dom-event-istrusted</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-istrusted">3.2. initialize an Event</a>
    <li><a href="#ref-for-dom-event-istrusted①">4.2. initialize a UIEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-node-document">
   <a href="https://dom.spec.whatwg.org/#concept-node-document">https://dom.spec.whatwg.org/#concept-node-document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-node-document">4.2. initialize a UIEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-stop-immediate-propagation-flag">
   <a href="https://dom.spec.whatwg.org/#stop-immediate-propagation-flag">https://dom.spec.whatwg.org/#stop-immediate-propagation-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-stop-immediate-propagation-flag">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-stop-propagation-flag">
   <a href="https://dom.spec.whatwg.org/#stop-propagation-flag">https://dom.spec.whatwg.org/#stop-propagation-flag</a><b>Referenced in:</b>
   <ul>
    <li><a href="#termref-for-">3.2. initialize an Event</a> <a href="#ref-for-stop-propagation-flag">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-target">
   <a href="https://dom.spec.whatwg.org/#dom-event-target">https://dom.spec.whatwg.org/#dom-event-target</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-target">3.2. initialize an Event</a>
    <li><a href="#ref-for-dom-event-target①">9.2. create PointerEvent from MouseEvent</a>
    <li><a href="#ref-for-dom-event-target②">9.3. maybe send pointerout event</a>
    <li><a href="#ref-for-dom-event-target③">9.4. maybe send pointerleave event</a>
    <li><a href="#ref-for-dom-event-target④">9.5. maybe send pointerover event</a>
    <li><a href="#ref-for-dom-event-target⑤">9.6. maybe send pointerenter event</a>
    <li><a href="#ref-for-dom-event-target⑥">9.7. maybe send pointermove event</a>
    <li><a href="#ref-for-dom-event-target⑦">9.8. maybe send pointerdown event</a>
    <li><a href="#ref-for-dom-event-target⑧">9.9. maybe send pointerup event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-timestamp">
   <a href="https://dom.spec.whatwg.org/#dom-event-timestamp">https://dom.spec.whatwg.org/#dom-event-timestamp</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-timestamp">3.2. initialize an Event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-event-type">
   <a href="https://dom.spec.whatwg.org/#dom-event-type">https://dom.spec.whatwg.org/#dom-event-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-event-type">3.2. initialize an Event</a>
    <li><a href="#ref-for-dom-event-type①">5.6. set MouseEvent attributes from native</a>
    <li><a href="#ref-for-dom-event-type②">10.4. set PointerLock attributes for mousemove</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-window">
   <a href="https://html.spec.whatwg.org/multipage/window-object.html#window">https://html.spec.whatwg.org/multipage/window-object.html#window</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-window">4.2. initialize a UIEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-click-focusable">
   <a href="https://html.spec.whatwg.org/#click-focusable">https://html.spec.whatwg.org/#click-focusable</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-click-focusable">5.7. handle native mouse down</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-dispatch">
   <a href="https://dom.spec.whatwg.org/#concept-event-dispatch">https://dom.spec.whatwg.org/#concept-event-dispatch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-dispatch">5.7. handle native mouse down</a> <a href="#ref-for-concept-event-dispatch①">(2)</a>
    <li><a href="#ref-for-concept-event-dispatch②">5.8. handle native mouse up</a>
    <li><a href="#ref-for-concept-event-dispatch③">5.9. handle native mouse click</a>
    <li><a href="#ref-for-concept-event-dispatch④">5.10. handle native mouse double click</a>
    <li><a href="#ref-for-concept-event-dispatch⑤">5.11. handle native mouse move</a> <a href="#ref-for-concept-event-dispatch⑥">(2)</a> <a href="#ref-for-concept-event-dispatch⑦">(3)</a> <a href="#ref-for-concept-event-dispatch⑧">(4)</a> <a href="#ref-for-concept-event-dispatch⑨">(5)</a>
    <li><a href="#ref-for-concept-event-dispatch①⓪">6.11. handle native key down</a>
    <li><a href="#ref-for-concept-event-dispatch①①">6.12. handle native key up</a>
    <li><a href="#ref-for-concept-event-dispatch①②">7.4. fire an InputEvent</a>
    <li><a href="#ref-for-concept-event-dispatch①③">8.4. fire a CompositionEvent</a>
    <li><a href="#ref-for-concept-event-dispatch①④">9.3. maybe send pointerout event</a>
    <li><a href="#ref-for-concept-event-dispatch①⑤">9.4. maybe send pointerleave event</a>
    <li><a href="#ref-for-concept-event-dispatch①⑥">9.5. maybe send pointerover event</a>
    <li><a href="#ref-for-concept-event-dispatch①⑦">9.6. maybe send pointerenter event</a>
    <li><a href="#ref-for-concept-event-dispatch①⑧">9.7. maybe send pointermove event</a>
    <li><a href="#ref-for-concept-event-dispatch①⑨">9.8. maybe send pointerdown event</a>
    <li><a href="#ref-for-concept-event-dispatch②⓪">9.9. maybe send pointerup event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-focusable-area">
   <a href="https://html.spec.whatwg.org/#focusable-area">https://html.spec.whatwg.org/#focusable-area</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-focusable-area">5.7. handle native mouse down</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-focusing-steps">
   <a href="https://html.spec.whatwg.org/#focusing-steps">https://html.spec.whatwg.org/#focusing-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-focusing-steps">5.7. handle native mouse down</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-pointerevent">
   <a href="https://www.w3.org/TR/pointerevents3/#dom-pointerevent">https://www.w3.org/TR/pointerevents3/#dom-pointerevent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-pointerevent">9.1. initialize a PointerEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-keyboardevent">
   <a href="https://www.w3.org/TR/uievents/#keyboardevent">https://www.w3.org/TR/uievents/#keyboardevent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboardevent">4.2. initialize a UIEvent</a>
    <li><a href="#ref-for-keyboardevent①">6.1. KeyboardEvent Interface</a>
    <li><a href="#ref-for-keyboardevent②">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-keyboardevent③">6.5. set event modifiers</a>
    <li><a href="#ref-for-keyboardevent④">6.6. set KeyboardEvent attributes</a>
    <li><a href="#ref-for-keyboardevent⑤">6.8. get modifier state</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-mouseevent">
   <a href="https://www.w3.org/TR/uievents/#mouseevent">https://www.w3.org/TR/uievents/#mouseevent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mouseevent">4.2. initialize a UIEvent</a>
    <li><a href="#ref-for-mouseevent①">5.1. MouseEvent Interface</a>
    <li><a href="#ref-for-mouseevent②">5.3. initialize a MouseEvent</a>
    <li><a href="#ref-for-mouseevent③">5.5. calculate MouseEvent button attribute</a>
    <li><a href="#ref-for-mouseevent④">5.6. set MouseEvent attributes from native</a>
    <li><a href="#ref-for-mouseevent⑤">6.5. set event modifiers</a>
    <li><a href="#ref-for-mouseevent⑥">9.2. create PointerEvent from MouseEvent</a>
    <li><a href="#ref-for-mouseevent⑦">9.3. maybe send pointerout event</a>
    <li><a href="#ref-for-mouseevent⑧">9.4. maybe send pointerleave event</a>
    <li><a href="#ref-for-mouseevent⑨">9.5. maybe send pointerover event</a>
    <li><a href="#ref-for-mouseevent①⓪">9.6. maybe send pointerenter event</a>
    <li><a href="#ref-for-mouseevent①①">9.7. maybe send pointermove event</a>
    <li><a href="#ref-for-mouseevent①②">9.8. maybe send pointerdown event</a>
    <li><a href="#ref-for-mouseevent①③">9.9. maybe send pointerup event</a>
    <li><a href="#ref-for-mouseevent①④">10.1. MouseEvent Interface Extension</a>
    <li><a href="#ref-for-mouseevent①⑤">10.3. initialize PointerLock attributes for MouseEvent</a>
    <li><a href="#ref-for-mouseevent①⑥">10.4. set PointerLock attributes for mousemove</a>
    <li><a href="#ref-for-mouseevent①⑦">13.1. initialize CSSOM attributes for MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-uievent">
   <a href="https://www.w3.org/TR/uievents/#uievent">https://www.w3.org/TR/uievents/#uievent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-uievent">4.1. UIEvent Interface</a>
    <li><a href="#ref-for-uievent①">4.2. initialize a UIEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-keyboardevent-charcode">
   <a href="https://www.w3.org/TR/uievents/#dom-keyboardevent-charcode">https://www.w3.org/TR/uievents/#dom-keyboardevent-charcode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-charcode">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-charcode①">6.6. set KeyboardEvent attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-compositionend">
   <a href="https://www.w3.org/TR/uievents/#compositionend">https://www.w3.org/TR/uievents/#compositionend</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-compositionend">8.1.1. Window-Level State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-compositionstart">
   <a href="https://www.w3.org/TR/uievents/#compositionstart">https://www.w3.org/TR/uievents/#compositionstart</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-compositionstart">8.1.1. Window-Level State</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-inputevent-data">
   <a href="https://www.w3.org/TR/uievents/#dom-inputevent-data">https://www.w3.org/TR/uievents/#dom-inputevent-data</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-inputevent-data">7.4. fire an InputEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-inputevent-inputtype">
   <a href="https://www.w3.org/TR/uievents/#dom-inputevent-inputtype">https://www.w3.org/TR/uievents/#dom-inputevent-inputtype</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-inputevent-inputtype">7.4. fire an InputEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-keys-modifier">
   <a href="https://www.w3.org/TR/uievents-key/#keys-modifier">https://www.w3.org/TR/uievents-key/#keys-modifier</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keys-modifier">6.2.1. User Agent-Level State</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CSS2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-viewport" style="color:initial">viewport</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSSOM-View]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-document-elementfrompoint" style="color:initial">elementfrompoint</span>
     <li><span class="dfn-paneled" id="term-for-dom-document-elementfrompoint①" style="color:initial">elementsfrompoint</span>
     <li><span class="dfn-paneled" id="term-for-dom-mouseevent-offsetx" style="color:initial">offsetX</span>
     <li><span class="dfn-paneled" id="term-for-dom-mouseevent-offsety" style="color:initial">offsetY</span>
     <li><span class="dfn-paneled" id="term-for-dom-mouseevent-pagex" style="color:initial">pageX</span>
     <li><span class="dfn-paneled" id="term-for-dom-mouseevent-pagey" style="color:initial">pageY</span>
     <li><span class="dfn-paneled" id="term-for-dom-mouseevent-x" style="color:initial">x</span>
     <li><span class="dfn-paneled" id="term-for-dom-mouseevent-y" style="color:initial">y</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-element" style="color:initial">Element</span>
     <li><span class="dfn-paneled" id="term-for-event" style="color:initial">Event</span>
     <li><span class="dfn-paneled" id="term-for-eventtarget" style="color:initial">EventTarget</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-none" style="color:initial">NONE</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-bubbles" style="color:initial">bubbles</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-cancelable" style="color:initial">cancelable</span>
     <li><span class="dfn-paneled" id="term-for-canceled-flag" style="color:initial">canceled flag</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-composed" style="color:initial">composed</span>
     <li><span class="dfn-paneled" id="term-for-composed-flag" style="color:initial">composed flag</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-currenttarget" style="color:initial">currentTarget</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-defaultprevented" style="color:initial">defaultPrevented</span>
     <li><span class="dfn-paneled" id="term-for-dispatch-flag" style="color:initial">dispatch flag</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-eventphase" style="color:initial">eventPhase</span>
     <li><span class="dfn-paneled" id="term-for-in-passive-listener-flag" style="color:initial">in passive listener flag</span>
     <li><span class="dfn-paneled" id="term-for-initialized-flag" style="color:initial">initialized flag</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-istrusted" style="color:initial">isTrusted</span>
     <li><span class="dfn-paneled" id="term-for-concept-node-document" style="color:initial">node document</span>
     <li><span class="dfn-paneled" id="term-for-stop-immediate-propagation-flag" style="color:initial">stop immediate propagation flag</span>
     <li><span class="dfn-paneled" id="term-for-stop-propagation-flag" style="color:initial">stop propagation flag</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-target" style="color:initial">target</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-timestamp" style="color:initial">timeStamp</span>
     <li><span class="dfn-paneled" id="term-for-dom-event-type" style="color:initial">type</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-window" style="color:initial">Window</span>
     <li><span class="dfn-paneled" id="term-for-click-focusable" style="color:initial">click focusable</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-dispatch" style="color:initial">dispatch</span>
     <li><span class="dfn-paneled" id="term-for-focusable-area" style="color:initial">focusable area</span>
     <li><span class="dfn-paneled" id="term-for-focusing-steps" style="color:initial">focusing steps</span>
    </ul>
   <li>
    <a data-link-type="biblio">[pointerevents3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-pointerevent" style="color:initial">PointerEvent</span>
    </ul>
   <li>
    <a data-link-type="biblio">[uievents]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-keyboardevent" style="color:initial">KeyboardEvent</span>
     <li><span class="dfn-paneled" id="term-for-mouseevent" style="color:initial">MouseEvent</span>
     <li><span class="dfn-paneled" id="term-for-uievent" style="color:initial">UIEvent</span>
     <li><span class="dfn-paneled" id="term-for-dom-keyboardevent-charcode" style="color:initial">charCode</span>
     <li><span class="dfn-paneled" id="term-for-compositionend" style="color:initial">compositionend</span>
     <li><span class="dfn-paneled" id="term-for-compositionstart" style="color:initial">compositionstart</span>
     <li><span class="dfn-paneled" id="term-for-dom-inputevent-data" style="color:initial">data <small>(for InputEvent)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-inputevent-inputtype" style="color:initial">inputType</span>
    </ul>
   <li>
    <a data-link-type="biblio">[uievents-key]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-keys-modifier" style="color:initial">modifier key</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css2">[CSS2]
   <dd>Bert Bos; et al. <a href="https://www.w3.org/TR/CSS2/">Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification</a>. 7 June 2011. REC. URL: <a href="https://www.w3.org/TR/CSS2/">https://www.w3.org/TR/CSS2/</a>
   <dt id="biblio-cssom-view">[CSSOM-View]
   <dd>Simon Pieters. <a href="https://www.w3.org/TR/cssom-view-1/">CSSOM View Module</a>. 17 March 2016. WD. URL: <a href="https://www.w3.org/TR/cssom-view-1/">https://www.w3.org/TR/cssom-view-1/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-pointerevents3">[POINTEREVENTS3]
   <dd>Patrick Lauke; Navid Zolghadr. <a href="https://www.w3.org/TR/pointerevents3/">Pointer Events Level 3</a>. 12 December 2019. WD. URL: <a href="https://www.w3.org/TR/pointerevents3/">https://www.w3.org/TR/pointerevents3/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-uievents">[UIEVENTS]
   <dd>Gary Kacmarcik; Travis Leithead; Doug Schepers. <a href="https://www.w3.org/TR/uievents/">UI Events</a>. 30 May 2019. WD. URL: <a href="https://www.w3.org/TR/uievents/">https://www.w3.org/TR/uievents/</a>
   <dt id="biblio-uievents-key">[UIEVENTS-KEY]
   <dd>Gary Kacmarcik; Travis Leithead. <a href="https://www.w3.org/TR/uievents-key/">UI Events KeyboardEvent key Values</a>. 1 June 2017. CR. URL: <a href="https://www.w3.org/TR/uievents-key/">https://www.w3.org/TR/uievents-key/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-cssom">[CSSOM]
   <dd>Simon Pieters; Glenn Adams. <a href="https://www.w3.org/TR/cssom-1/">CSS Object Model (CSSOM)</a>. 17 March 2016. WD. URL: <a href="https://www.w3.org/TR/cssom-1/">https://www.w3.org/TR/cssom-1/</a>
   <dt id="biblio-pointerlock">[PointerLock]
   <dd>Vincent Scheib. <a href="https://www.w3.org/TR/pointerlock/">Pointer Lock</a>. 27 October 2016. REC. URL: <a href="https://www.w3.org/TR/pointerlock/">https://www.w3.org/TR/pointerlock/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> IMEs differ wildly on different platforms, and often have different capabilities
(such as whether or not they can be "canceled") even on the same platform.
What is the common set of requirements that we can rely on?<a href="#issue-39f24517"> ↵ </a></div>
   <div class="issue"> For example, on Windows, Win+'.' opens an emoji window that will generate
composition events. But there is not indication from the OS that composition
is about to take place. A similar problem exists with "shape writing" using the
virtual keyboard.<a href="#issue-dba77cfe"> ↵ </a></div>
   <div class="issue"> Move to/merge with <a data-link-type="biblio" href="#biblio-dom">[DOM]</a> spec <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#event">Event</a></code> interface.<a href="#issue-a52634a8"> ↵ </a></div>
   <div class="issue"> This is a proposal.
    See <a href="https://github.com/w3c/uievents/issues/270">uievents/270</a><a href="#issue-8b668288"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314"> ↵ </a></div>
   <div class="issue"> Other buttons can be added starting with 0x08<a href="#issue-e1271e39"> ↵ </a></div>
   <div class="issue"> This algorithm makes assumptions about the dispatch of PointerEvents because they
    are not currently specified explicitly. Once <a href="https://github.com/w3c/pointerevents/issues/285">pointerevents/285</a> is resolved
    this may need to be updated.<a href="#issue-5a61aefb"> ↵ </a></div>
   <div class="issue"> TODO: Set <var>mouseout</var> attributes from <var>native</var>. +CSSOM attributes<a href="#issue-6c6e5fe0"> ↵ </a></div>
   <div class="issue"> Verify behavior when canceled (appears to have no effect).<a href="#issue-f864a356"> ↵ </a></div>
   <div class="issue"> Compat: Value of event.composed. Spec says false.
Chrome/Linux = true
Firefox/Linux = false<a href="#issue-ab0000b0"> ↵ </a></div>
   <div class="issue"> TODO: Set <var>mouseout</var> attributes from <var>native</var>. +CSSOM attributes<a href="#issue-6c6e5fe0①"> ↵ </a></div>
   <div class="issue"> Verify behavior when canceled (appears to have no effect).<a href="#issue-f864a356①"> ↵ </a></div>
   <div class="issue"> Compat: Value of event.composed. Spec says false.
Chrome/Linux = true
Firefox/Linux = false<a href="#issue-ab0000b0①"> ↵ </a></div>
   <div class="issue"> Compat for shadow DOM elements
Chrome/Linux fires this event at the element and the shadow root<a href="#issue-9a3a918a"> ↵ </a></div>
   <div class="issue"> Need to review: ScrollLock, Hyper, Super, and (for virtual keyboards) Symbol, SymbolLock<a href="#issue-b4147fbf"> ↵ </a></div>
   <div class="issue"> eval: ScrollLock, Hyper, Super, and (for virtual keyboards) Symbol, SymbolLock<a href="#issue-359c7cda"> ↵ </a></div>
   <div class="issue"> Needs more formal description of non-printable characters<a href="#issue-d5cc0d9d"> ↵ </a></div>
   <div class="issue"> Need to include description of how AltGraph should be handled.
See <a href="https://github.com/w3c/uievents/issues/147">uievents/147</a><a href="#issue-2200ddf1"> ↵ </a></div>
   <div class="issue"> TODO: For historical reasons, we can’t have a formal description of these
fields without recognizing that certain UAs produce different values.<a href="#issue-40bc3077"> ↵ </a></div>
   <div class="issue"> These key shortcuts are defined by the User Agent  (e.g., Cmd-T on Mac).
    They should be defined in such a way that the UA is in control.<a href="#issue-95f8c21d"> ↵ </a></div>
   <div class="issue"> Need a more complete list of these pre-keydown browser keys, or a better description
    of the sort of keys the UA handles.<a href="#issue-ab1accc3"> ↵ </a></div>
   <div class="issue"> IME is often provided by the native OS. So the requirements need to be
    defined and added to the <a href="#req-ime">IME Requirements</a> section.<a href="#issue-3845ba6b"> ↵ </a></div>
   <div class="issue"> How should IME keys be represented. We need the native OS to call <a data-link-type="dfn" href="#enter-composition-mode">enter composition mode</a> and <a data-link-type="dfn" href="#exit-composition-mode">exit composition mode</a><a href="#issue-93e6f32f"> ↵ </a></div>
   <div class="issue"> When should <a data-link-type="dfn" href="#begin-composition">begin composition</a> be called? How should that be hooked with
    the native IME calls.<a href="#issue-d744c6c4"> ↵ </a></div>
   <div class="issue"> Placeholder until there’s an actual agreed-upon definition for Keyboard Lock.<a href="#issue-713be494"> ↵ </a></div>
   <div class="issue"> Need more complete set of post-keydown browser keys. Perhaps define
a set of common browser keys (clipboard, open/close tabs, quit).<a href="#issue-9a62a3b5"> ↵ </a></div>
   <div class="issue"> Is this check necessary?
Can native CHAR events be ignored or do they contain needed info?<a href="#issue-41fee8f3"> ↵ </a></div>
   <div class="issue"> What should happen if the event focus has changed since the keydown event?
What is the appropriate target for the keyup? The current focus or the previous?
Are there security issues (e.g., if it’s not safe to edit the current focus)?<a href="#issue-beb23471"> ↵ </a></div>
   <div class="issue"> Move the following into InputEvents spec
(<a href="https://www.w3.org/TR/input-events-1/">level 1</a> or <a href="https://www.w3.org/TR/input-events-2/">level 2</a>)
since that’s where these attributes are defined.<a href="#issue-0a3912f8"> ↵ </a></div>
   <div class="issue"> Handle historical keypress event here<a href="#issue-36b7f0ac"> ↵ </a></div>
   <div class="issue"> How much of this can be moved into the [[Input Events]] spec?
    Issue: List more keys here<a href="#issue-10cc14f1"> ↵ </a></div>
   <div class="issue"> What about target ranges? Need to add support here.<a href="#issue-3dc727e9"> ↵ </a></div>
   <div class="issue"> The target for input events should consider focus, but should also ensure that
    the element is editable and being modified.
    Compare: <a data-link-type="dfn" href="#fire-a-compositionevent">fire a compositionevent</a><a href="#issue-616da821"> ↵ </a></div>
   <div class="issue"> The target for compositionstart should be determined by the element with
focus, but subsequent composition events should be fired on that same element.
Need to test what happens when focus changes during composition.
On the Mac, if you change focus, the composition target changes.
On Windows, behavior depends on the IME.<a href="#issue-82843cb4"> ↵ </a></div>
   <div class="issue"> This is an oversimplification. We need to native OS to call then when the user
    enters composition mode.<a href="#issue-35af4a5a"> ↵ </a></div>
   <div class="issue"> Need agreement on event order for compositionupdate and beforeinput.
    Chrome currently does bi -> cu, whereas Safari does cu -> bi.
    Firefox doesn’t yet produce bi, but prefers cu -> bi.
    See <a href="https://github.com/w3c/input-events/issues/49">input-events/49</a> and <a href="https://github.com/w3c/uievents/issues/66">uievents/66</a><a href="#issue-2d2dfa96"> ↵ </a></div>
   <div class="issue"> Verify compositionupdate cannot be canceled<a href="#issue-2170a384"> ↵ </a></div>
   <div class="issue"> Not all beforeinput events can be canceled - need to encode that here<a href="#issue-8be390f6"> ↵ </a></div>
   <div class="issue"> Document what happens when <var>result</var> is not true (event canceled)<a href="#issue-e3eb5b91"> ↵ </a></div>
   <div class="issue"> Compat: Chrome sends out beforeinput/compositionupdate/input sequence before
    compositionend (tested on macOS). Compare with Firefox.<a href="#issue-271d403d"> ↵ </a></div>
   <div class="issue"> Document what to do with result<a href="#issue-acf5a28c"> ↵ </a></div>
   <div class="issue"> Compat: Firefox sends input events after compositionend. Not sure when the
DOM is updated relative to compositionend (tested on macOS). Need to resolve this.<a href="#issue-273f9f41"> ↵ </a></div>
   <div class="issue"> The contents of this section should eventually be moved into the PointerEvent spec.<a href="#issue-6c0044ca"> ↵ </a></div>
   <div class="issue"> TODO - initialize the pointerevent attributes<a href="#issue-b7cb6aa8"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314①"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314②"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314③"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314④"> ↵ </a></div>
   <div class="issue"> Can this send pointermove and pointerrawupdate? Or do we need 2 methods?<a href="#issue-db237ad4"> ↵ </a></div>
   <div class="issue"> What is needed to properly define how pointermove events are coalesced?<a href="#issue-a521983e"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314⑤"> ↵ </a></div>
   <div class="issue"> Unlike mousedown events, <a href="https://w3c.github.io/pointerevents/#the-pointerdown-event">pointerdown</a> events are not nested when multiple buttons are pressed.
    The MouseEvent is passed so that the fields can be copied into the PointerEvent.<a href="#issue-ac02e1f6"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314⑥"> ↵ </a></div>
   <div class="issue"> Unlike mouseup events, <a href="https://w3c.github.io/pointerevents/#the-pointerup-event">pointerup</a> events are not nested when multiple buttons are pressed.
    The MouseEvent is passed so that the fields can be copied into the PointerEvent.<a href="#issue-571ee343"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314⑦"> ↵ </a></div>
   <div class="issue"> The contents of this section should eventually be moved into the <a data-link-type="biblio" href="#biblio-pointerlock">[PointerLock]</a> spec<a href="#issue-972fa7f3"> ↵ </a></div>
   <div class="issue"> KeyboardLock is not yet an accepted standard and is included here as a placeholder
to explore how it might be integrated.<a href="#issue-37fef50b"> ↵ </a></div>
   <div class="issue"> The contents of this section should eventually be moved into the [[WICG Keyboard Lock]] spec<a href="#issue-e74af8f5"> ↵ </a></div>
   <div class="issue"> TODO<a href="#issue-b7b1e314⑧"> ↵ </a></div>
   <div class="issue"> These definitions probably belong in another spec.<a href="#issue-65045046"> ↵ </a></div>
   <div class="issue"> To account for <a href="https://html.spec.whatwg.org/#inert">inert</a> or <a href="https://html.spec.whatwg.org/#concept-fe-disabled">disabled</a> elements. this should call <a data-link-type="dfn" href="https://www.w3.org/TR/cssom-view-1/#dom-document-elementfrompoint">elementsFromPoint</a> and reject
    invalid elements<a href="#issue-d31c8856"> ↵ </a></div>
   <div class="issue"> This needs a proper definition to add ancestors to <var>path</var>.<a href="#issue-b8797d0c"> ↵ </a></div>
   <div class="issue"> The contents of this section should eventually be moved into the <a data-link-type="biblio" href="#biblio-cssom">[CSSOM]</a> spec<a href="#issue-2236bbea"> ↵ </a></div>
   <div class="issue"> Should these be moved into the Clipboard spec?<a href="#issue-5ce38960"> ↵ </a></div>
   <div class="issue"> Define when the "cut" event is fired.<a href="#issue-86dbc66c"> ↵ </a></div>
   <div class="issue"> Define when "copy" event is fired. Should that be in the Clipboard Spec?<a href="#issue-4a872fb7"> ↵ </a></div>
   <div class="issue"> Define when the "paste" event is fired.<a href="#issue-c9eb8a10"> ↵ </a></div>
  </div>
  <aside class="dfn-panel" data-for="uievent-due-to-user-interaction-flag">
   <b><a href="#uievent-due-to-user-interaction-flag">#uievent-due-to-user-interaction-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-uievent-due-to-user-interaction-flag">3.2. initialize an Event</a>
    <li><a href="#ref-for-uievent-due-to-user-interaction-flag①">4.2. initialize a UIEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-an-event">
   <b><a href="#initialize-an-event">#initialize-an-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-an-event">4.2. initialize a UIEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-uievent-view">
   <b><a href="#dom-uievent-view">#dom-uievent-view</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-uievent-view">4.2. initialize a UIEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-uievent-detail">
   <b><a href="#dom-uievent-detail">#dom-uievent-detail</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-uievent-detail">4.2. initialize a UIEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-which">
   <b><a href="#dom-keyboardevent-which">#dom-keyboardevent-which</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-which">4.2. initialize a UIEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-which①">6.6. set KeyboardEvent attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-a-uievent">
   <b><a href="#initialize-a-uievent">#initialize-a-uievent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-a-uievent">5.3. initialize a MouseEvent</a>
    <li><a href="#ref-for-initialize-a-uievent①">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-initialize-a-uievent②">7.1. initialize an InputEvent</a>
    <li><a href="#ref-for-initialize-a-uievent③">8.2. initialize a CompositionEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mouseevent-screenx">
   <b><a href="#dom-mouseevent-screenx">#dom-mouseevent-screenx</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-screenx">5.3. initialize a MouseEvent</a>
    <li><a href="#ref-for-dom-mouseevent-screenx①">10.4. set PointerLock attributes for mousemove</a> <a href="#ref-for-dom-mouseevent-screenx②">(2)</a> <a href="#ref-for-dom-mouseevent-screenx③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mouseevent-screeny">
   <b><a href="#dom-mouseevent-screeny">#dom-mouseevent-screeny</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-screeny">5.3. initialize a MouseEvent</a>
    <li><a href="#ref-for-dom-mouseevent-screeny①">10.4. set PointerLock attributes for mousemove</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mouseevent-clientx">
   <b><a href="#dom-mouseevent-clientx">#dom-mouseevent-clientx</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-clientx">5.3. initialize a MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mouseevent-clienty">
   <b><a href="#dom-mouseevent-clienty">#dom-mouseevent-clienty</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-clienty">5.3. initialize a MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mouseevent-button">
   <b><a href="#dom-mouseevent-button">#dom-mouseevent-button</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-button">5.3. initialize a MouseEvent</a>
    <li><a href="#ref-for-dom-mouseevent-button①">5.5. calculate MouseEvent button attribute</a>
    <li><a href="#ref-for-dom-mouseevent-button②">5.6. set MouseEvent attributes from native</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mouseevent-buttons">
   <b><a href="#dom-mouseevent-buttons">#dom-mouseevent-buttons</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-buttons">5.3. initialize a MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="mouse-button-bitmask">
   <b><a href="#mouse-button-bitmask">#mouse-button-bitmask</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mouse-button-bitmask">5.3. initialize a MouseEvent</a>
    <li><a href="#ref-for-mouse-button-bitmask①">5.7. handle native mouse down</a>
    <li><a href="#ref-for-mouse-button-bitmask②">5.8. handle native mouse up</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="last-mouse-element">
   <b><a href="#last-mouse-element">#last-mouse-element</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-last-mouse-element">5.2.2. Window-Level State</a>
    <li><a href="#ref-for-last-mouse-element①">5.11. handle native mouse move</a> <a href="#ref-for-last-mouse-element②">(2)</a> <a href="#ref-for-last-mouse-element③">(3)</a> <a href="#ref-for-last-mouse-element④">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="last-mouse-dom-path">
   <b><a href="#last-mouse-dom-path">#last-mouse-dom-path</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-last-mouse-dom-path">5.11. handle native mouse move</a> <a href="#ref-for-last-mouse-dom-path①">(2)</a> <a href="#ref-for-last-mouse-dom-path②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-a-mouseevent">
   <b><a href="#initialize-a-mouseevent">#initialize-a-mouseevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-a-mouseevent">5.4. create a MouseEvent</a>
    <li><a href="#ref-for-initialize-a-mouseevent①">9.1. initialize a PointerEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-mouseevent">
   <b><a href="#create-a-mouseevent">#create-a-mouseevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-mouseevent">5.7. handle native mouse down</a> <a href="#ref-for-create-a-mouseevent①">(2)</a>
    <li><a href="#ref-for-create-a-mouseevent②">5.8. handle native mouse up</a>
    <li><a href="#ref-for-create-a-mouseevent③">5.9. handle native mouse click</a>
    <li><a href="#ref-for-create-a-mouseevent④">5.10. handle native mouse double click</a>
    <li><a href="#ref-for-create-a-mouseevent⑤">5.11. handle native mouse move</a> <a href="#ref-for-create-a-mouseevent⑥">(2)</a> <a href="#ref-for-create-a-mouseevent⑦">(3)</a> <a href="#ref-for-create-a-mouseevent⑧">(4)</a> <a href="#ref-for-create-a-mouseevent⑨">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="calculate-mouseevent-button-attribute">
   <b><a href="#calculate-mouseevent-button-attribute">#calculate-mouseevent-button-attribute</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-calculate-mouseevent-button-attribute">5.6. set MouseEvent attributes from native</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-mouseevent-attributes-from-native">
   <b><a href="#set-mouseevent-attributes-from-native">#set-mouseevent-attributes-from-native</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-mouseevent-attributes-from-native">5.7. handle native mouse down</a>
    <li><a href="#ref-for-set-mouseevent-attributes-from-native①">5.8. handle native mouse up</a>
    <li><a href="#ref-for-set-mouseevent-attributes-from-native②">5.9. handle native mouse click</a>
    <li><a href="#ref-for-set-mouseevent-attributes-from-native③">5.10. handle native mouse double click</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-mouse-down">
   <b><a href="#handle-native-mouse-down">#handle-native-mouse-down</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-mouse-down">2.4.1. Mouse</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-mouse-up">
   <b><a href="#handle-native-mouse-up">#handle-native-mouse-up</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-mouse-up">2.4.1. Mouse</a>
    <li><a href="#ref-for-handle-native-mouse-up①">5.9. handle native mouse click</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-mouse-click">
   <b><a href="#handle-native-mouse-click">#handle-native-mouse-click</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-mouse-click">2.4.1. Mouse</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-mouse-double-click">
   <b><a href="#handle-native-mouse-double-click">#handle-native-mouse-double-click</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-mouse-double-click">2.4.1. Mouse</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-mouse-move">
   <b><a href="#handle-native-mouse-move">#handle-native-mouse-move</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-mouse-move">2.4.1. Mouse</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-dom_key_location_standard">
   <b><a href="#dom-keyboardevent-dom_key_location_standard">#dom-keyboardevent-dom_key_location_standard</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-dom_key_location_standard">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-dom_key_location_standard①">6.7. calculate key location</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-dom_key_location_left">
   <b><a href="#dom-keyboardevent-dom_key_location_left">#dom-keyboardevent-dom_key_location_left</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-dom_key_location_left">6.7. calculate key location</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-dom_key_location_right">
   <b><a href="#dom-keyboardevent-dom_key_location_right">#dom-keyboardevent-dom_key_location_right</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-dom_key_location_right">6.7. calculate key location</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-dom_key_location_numpad">
   <b><a href="#dom-keyboardevent-dom_key_location_numpad">#dom-keyboardevent-dom_key_location_numpad</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-dom_key_location_numpad">6.7. calculate key location</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-key">
   <b><a href="#dom-keyboardevent-key">#dom-keyboardevent-key</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-key">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-key①">6.6. set KeyboardEvent attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-code">
   <b><a href="#dom-keyboardevent-code">#dom-keyboardevent-code</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-code">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-code①">6.6. set KeyboardEvent attributes</a>
    <li><a href="#ref-for-dom-keyboardevent-code②">6.7. calculate key location</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-location">
   <b><a href="#dom-keyboardevent-location">#dom-keyboardevent-location</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-location">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-location①">6.6. set KeyboardEvent attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-ctrlkey">
   <b><a href="#dom-keyboardevent-ctrlkey">#dom-keyboardevent-ctrlkey</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-ctrlkey">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-ctrlkey①">6.5. set event modifiers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-shiftkey">
   <b><a href="#dom-keyboardevent-shiftkey">#dom-keyboardevent-shiftkey</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-shiftkey">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-shiftkey①">6.5. set event modifiers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-altkey">
   <b><a href="#dom-keyboardevent-altkey">#dom-keyboardevent-altkey</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-altkey">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-altkey①">6.5. set event modifiers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-metakey">
   <b><a href="#dom-keyboardevent-metakey">#dom-keyboardevent-metakey</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-metakey">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-metakey①">6.5. set event modifiers</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-repeat">
   <b><a href="#dom-keyboardevent-repeat">#dom-keyboardevent-repeat</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-repeat">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-repeat①">6.6. set KeyboardEvent attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-iscomposing">
   <b><a href="#dom-keyboardevent-iscomposing">#dom-keyboardevent-iscomposing</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-iscomposing">6.3. initialize a KeyboardEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-keyboardevent-keycode">
   <b><a href="#dom-keyboardevent-keycode">#dom-keyboardevent-keycode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-keyboardevent-keycode">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-dom-keyboardevent-keycode①">6.6. set KeyboardEvent attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboardevent-shift-flag">
   <b><a href="#keyboardevent-shift-flag">#keyboardevent-shift-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboardevent-shift-flag">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-keyboardevent-shift-flag①">6.5. set event modifiers</a> <a href="#ref-for-keyboardevent-shift-flag②">(2)</a>
    <li><a href="#ref-for-keyboardevent-shift-flag③">6.8. get modifier state</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboardevent-control-flag">
   <b><a href="#keyboardevent-control-flag">#keyboardevent-control-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboardevent-control-flag">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-keyboardevent-control-flag①">6.5. set event modifiers</a> <a href="#ref-for-keyboardevent-control-flag②">(2)</a>
    <li><a href="#ref-for-keyboardevent-control-flag③">6.8. get modifier state</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboardevent-alt-flag">
   <b><a href="#keyboardevent-alt-flag">#keyboardevent-alt-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboardevent-alt-flag">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-keyboardevent-alt-flag①">6.5. set event modifiers</a> <a href="#ref-for-keyboardevent-alt-flag②">(2)</a>
    <li><a href="#ref-for-keyboardevent-alt-flag③">6.8. get modifier state</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboardevent-altgraph-flag">
   <b><a href="#keyboardevent-altgraph-flag">#keyboardevent-altgraph-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboardevent-altgraph-flag">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-keyboardevent-altgraph-flag①">6.5. set event modifiers</a> <a href="#ref-for-keyboardevent-altgraph-flag②">(2)</a>
    <li><a href="#ref-for-keyboardevent-altgraph-flag③">6.8. get modifier state</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboardevent-meta-flag">
   <b><a href="#keyboardevent-meta-flag">#keyboardevent-meta-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboardevent-meta-flag">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-keyboardevent-meta-flag①">6.5. set event modifiers</a> <a href="#ref-for-keyboardevent-meta-flag②">(2)</a>
    <li><a href="#ref-for-keyboardevent-meta-flag③">6.8. get modifier state</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboardevent-capslock-flag">
   <b><a href="#keyboardevent-capslock-flag">#keyboardevent-capslock-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboardevent-capslock-flag">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-keyboardevent-capslock-flag①">6.5. set event modifiers</a>
    <li><a href="#ref-for-keyboardevent-capslock-flag②">6.8. get modifier state</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboardevent-numlock-flag">
   <b><a href="#keyboardevent-numlock-flag">#keyboardevent-numlock-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboardevent-numlock-flag">6.3. initialize a KeyboardEvent</a>
    <li><a href="#ref-for-keyboardevent-numlock-flag①">6.5. set event modifiers</a>
    <li><a href="#ref-for-keyboardevent-numlock-flag②">6.8. get modifier state</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="key-modifier-state">
   <b><a href="#key-modifier-state">#key-modifier-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-key-modifier-state">6.5. set event modifiers</a> <a href="#ref-for-key-modifier-state①">(2)</a> <a href="#ref-for-key-modifier-state②">(3)</a> <a href="#ref-for-key-modifier-state③">(4)</a> <a href="#ref-for-key-modifier-state④">(5)</a> <a href="#ref-for-key-modifier-state⑤">(6)</a> <a href="#ref-for-key-modifier-state⑥">(7)</a>
    <li><a href="#ref-for-key-modifier-state⑦">6.11. handle native key down</a> <a href="#ref-for-key-modifier-state⑧">(2)</a> <a href="#ref-for-key-modifier-state⑨">(3)</a> <a href="#ref-for-key-modifier-state①⓪">(4)</a> <a href="#ref-for-key-modifier-state①①">(5)</a>
    <li><a href="#ref-for-key-modifier-state①②">6.12. handle native key up</a> <a href="#ref-for-key-modifier-state①③">(2)</a> <a href="#ref-for-key-modifier-state①④">(3)</a> <a href="#ref-for-key-modifier-state①⑤">(4)</a> <a href="#ref-for-key-modifier-state①⑥">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="suppress-key-input-events-flag">
   <b><a href="#suppress-key-input-events-flag">#suppress-key-input-events-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-suppress-key-input-events-flag">6.11. handle native key down</a> <a href="#ref-for-suppress-key-input-events-flag①">(2)</a>
    <li><a href="#ref-for-suppress-key-input-events-flag②">7.3. fire key input events</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-a-keyboardevent">
   <b><a href="#initialize-a-keyboardevent">#initialize-a-keyboardevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-a-keyboardevent">6.4. create a KeyboardEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-keyboardevent">
   <b><a href="#create-a-keyboardevent">#create-a-keyboardevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-keyboardevent">6.11. handle native key down</a>
    <li><a href="#ref-for-create-a-keyboardevent①">6.12. handle native key up</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-event-modifiers">
   <b><a href="#set-event-modifiers">#set-event-modifiers</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-event-modifiers">5.3. initialize a MouseEvent</a>
    <li><a href="#ref-for-set-event-modifiers①">6.6. set KeyboardEvent attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-keyboardevent-attributes">
   <b><a href="#set-keyboardevent-attributes">#set-keyboardevent-attributes</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-keyboardevent-attributes">6.11. handle native key down</a>
    <li><a href="#ref-for-set-keyboardevent-attributes①">6.12. handle native key up</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="calculate-key-location">
   <b><a href="#calculate-key-location">#calculate-key-location</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-calculate-key-location">6.6. set KeyboardEvent attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="get-modifier-state">
   <b><a href="#get-modifier-state">#get-modifier-state</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-get-modifier-state">6.1. KeyboardEvent Interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-pre-browser-key">
   <b><a href="#handle-pre-browser-key">#handle-pre-browser-key</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-pre-browser-key">6.11. handle native key down</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-post-browser-key">
   <b><a href="#handle-post-browser-key">#handle-post-browser-key</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-post-browser-key">6.13. handle native key press</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-key-down">
   <b><a href="#handle-native-key-down">#handle-native-key-down</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-key-down">2.4.2. Keyboard</a>
    <li><a href="#ref-for-handle-native-key-down①">6.13. handle native key press</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-key-up">
   <b><a href="#handle-native-key-up">#handle-native-key-up</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-key-up">2.4.2. Keyboard</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-key-press">
   <b><a href="#handle-native-key-press">#handle-native-key-press</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-key-press">2.4.2. Keyboard</a>
    <li><a href="#ref-for-handle-native-key-press①">6.11. handle native key down</a> <a href="#ref-for-handle-native-key-press②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-an-inputevent">
   <b><a href="#initialize-an-inputevent">#initialize-an-inputevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-an-inputevent">7.2. create an InputEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-an-inputevent">
   <b><a href="#create-an-inputevent">#create-an-inputevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-an-inputevent">7.4. fire an InputEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fire-key-input-events">
   <b><a href="#fire-key-input-events">#fire-key-input-events</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fire-key-input-events">6.13. handle native key press</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fire-an-inputevent">
   <b><a href="#fire-an-inputevent">#fire-an-inputevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fire-an-inputevent">7.3. fire key input events</a> <a href="#ref-for-fire-an-inputevent①">(2)</a>
    <li><a href="#ref-for-fire-an-inputevent②">8.7. handle composition key</a> <a href="#ref-for-fire-an-inputevent③">(2)</a>
    <li><a href="#ref-for-fire-an-inputevent④">8.9. end composition</a>
    <li><a href="#ref-for-fire-an-inputevent⑤">14.1. handle native cut</a> <a href="#ref-for-fire-an-inputevent⑥">(2)</a>
    <li><a href="#ref-for-fire-an-inputevent⑦">14.3. handle native paste</a> <a href="#ref-for-fire-an-inputevent⑧">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="composition-mode-flag">
   <b><a href="#composition-mode-flag">#composition-mode-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-composition-mode-flag">6.13. handle native key press</a>
    <li><a href="#ref-for-composition-mode-flag①">8.5. enter composition mode</a>
    <li><a href="#ref-for-composition-mode-flag②">8.6. exit composition mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="in-composition-flag">
   <b><a href="#in-composition-flag">#in-composition-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-composition-flag">6.11. handle native key down</a>
    <li><a href="#ref-for-in-composition-flag①">8.8. begin composition</a> <a href="#ref-for-in-composition-flag②">(2)</a>
    <li><a href="#ref-for-in-composition-flag③">8.9. end composition</a> <a href="#ref-for-in-composition-flag④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-a-compositionevent">
   <b><a href="#initialize-a-compositionevent">#initialize-a-compositionevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-a-compositionevent">8.3. create a CompositionEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-a-compositionevent">
   <b><a href="#create-a-compositionevent">#create-a-compositionevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-a-compositionevent">8.4. fire a CompositionEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fire-a-compositionevent">
   <b><a href="#fire-a-compositionevent">#fire-a-compositionevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fire-a-compositionevent">7.4. fire an InputEvent</a>
    <li><a href="#ref-for-fire-a-compositionevent①">8.7. handle composition key</a>
    <li><a href="#ref-for-fire-a-compositionevent②">8.8. begin composition</a>
    <li><a href="#ref-for-fire-a-compositionevent③">8.9. end composition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enter-composition-mode">
   <b><a href="#enter-composition-mode">#enter-composition-mode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enter-composition-mode">6.9. handle pre browser key</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="exit-composition-mode">
   <b><a href="#exit-composition-mode">#exit-composition-mode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exit-composition-mode">6.9. handle pre browser key</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-composition-key">
   <b><a href="#handle-composition-key">#handle-composition-key</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-composition-key">6.11. handle native key down</a>
    <li><a href="#ref-for-handle-composition-key①">6.13. handle native key press</a>
    <li><a href="#ref-for-handle-composition-key②">8.8. begin composition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="begin-composition">
   <b><a href="#begin-composition">#begin-composition</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-begin-composition">6.9. handle pre browser key</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="end-composition">
   <b><a href="#end-composition">#end-composition</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-end-composition">8.6. exit composition mode</a>
    <li><a href="#ref-for-end-composition①">8.7. handle composition key</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-a-pointerevent">
   <b><a href="#initialize-a-pointerevent">#initialize-a-pointerevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-a-pointerevent">9.2. create PointerEvent from MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="create-pointerevent-from-mouseevent">
   <b><a href="#create-pointerevent-from-mouseevent">#create-pointerevent-from-mouseevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-create-pointerevent-from-mouseevent">9.3. maybe send pointerout event</a>
    <li><a href="#ref-for-create-pointerevent-from-mouseevent①">9.4. maybe send pointerleave event</a>
    <li><a href="#ref-for-create-pointerevent-from-mouseevent②">9.5. maybe send pointerover event</a>
    <li><a href="#ref-for-create-pointerevent-from-mouseevent③">9.6. maybe send pointerenter event</a>
    <li><a href="#ref-for-create-pointerevent-from-mouseevent④">9.7. maybe send pointermove event</a>
    <li><a href="#ref-for-create-pointerevent-from-mouseevent⑤">9.8. maybe send pointerdown event</a>
    <li><a href="#ref-for-create-pointerevent-from-mouseevent⑥">9.9. maybe send pointerup event</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="maybe-send-pointerout-event">
   <b><a href="#maybe-send-pointerout-event">#maybe-send-pointerout-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-maybe-send-pointerout-event">5.11. handle native mouse move</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="maybe-send-pointerleave-event">
   <b><a href="#maybe-send-pointerleave-event">#maybe-send-pointerleave-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-maybe-send-pointerleave-event">5.11. handle native mouse move</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="maybe-send-pointerover-event">
   <b><a href="#maybe-send-pointerover-event">#maybe-send-pointerover-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-maybe-send-pointerover-event">5.11. handle native mouse move</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="maybe-send-pointerenter-event">
   <b><a href="#maybe-send-pointerenter-event">#maybe-send-pointerenter-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-maybe-send-pointerenter-event">5.11. handle native mouse move</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="maybe-send-pointermove-event">
   <b><a href="#maybe-send-pointermove-event">#maybe-send-pointermove-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-maybe-send-pointermove-event">5.11. handle native mouse move</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="maybe-send-pointerdown-event">
   <b><a href="#maybe-send-pointerdown-event">#maybe-send-pointerdown-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-maybe-send-pointerdown-event">5.7. handle native mouse down</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="maybe-send-pointerup-event">
   <b><a href="#maybe-send-pointerup-event">#maybe-send-pointerup-event</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-maybe-send-pointerup-event">5.8. handle native mouse up</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mouseevent-movementx">
   <b><a href="#dom-mouseevent-movementx">#dom-mouseevent-movementx</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-movementx">10.3. initialize PointerLock attributes for MouseEvent</a>
    <li><a href="#ref-for-dom-mouseevent-movementx①">10.4. set PointerLock attributes for mousemove</a> <a href="#ref-for-dom-mouseevent-movementx②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mouseevent-movementy">
   <b><a href="#dom-mouseevent-movementy">#dom-mouseevent-movementy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mouseevent-movementy">10.3. initialize PointerLock attributes for MouseEvent</a>
    <li><a href="#ref-for-dom-mouseevent-movementy①">10.4. set PointerLock attributes for mousemove</a> <a href="#ref-for-dom-mouseevent-movementy②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="last-mouse-move">
   <b><a href="#last-mouse-move">#last-mouse-move</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-last-mouse-move">10.4. set PointerLock attributes for mousemove</a> <a href="#ref-for-last-mouse-move①">(2)</a> <a href="#ref-for-last-mouse-move②">(3)</a> <a href="#ref-for-last-mouse-move③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-pointerlock-attributes-for-mouseevent">
   <b><a href="#initialize-pointerlock-attributes-for-mouseevent">#initialize-pointerlock-attributes-for-mouseevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-pointerlock-attributes-for-mouseevent">5.3. initialize a MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-pointerlock-attributes-for-mousemove">
   <b><a href="#set-pointerlock-attributes-for-mousemove">#set-pointerlock-attributes-for-mousemove</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-pointerlock-attributes-for-mousemove">5.11. handle native mouse move</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboard-lock-enable-flag">
   <b><a href="#keyboard-lock-enable-flag">#keyboard-lock-enable-flag</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboard-lock-enable-flag">11.2. Keyboard Lock is enabled</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="keyboard-lock-is-enabled">
   <b><a href="#keyboard-lock-is-enabled">#keyboard-lock-is-enabled</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-keyboard-lock-is-enabled">6.9. handle pre browser key</a>
    <li><a href="#ref-for-keyboard-lock-is-enabled①">6.10. handle post browser key</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="hit-test">
   <b><a href="#hit-test">#hit-test</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-hit-test">5.7. handle native mouse down</a>
    <li><a href="#ref-for-hit-test①">5.8. handle native mouse up</a>
    <li><a href="#ref-for-hit-test②">5.9. handle native mouse click</a>
    <li><a href="#ref-for-hit-test③">5.10. handle native mouse double click</a>
    <li><a href="#ref-for-hit-test④">5.11. handle native mouse move</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="calculate-dom-path">
   <b><a href="#calculate-dom-path">#calculate-dom-path</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-calculate-dom-path">5.11. handle native mouse move</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="initialize-cssom-attributes-for-mouseevent">
   <b><a href="#initialize-cssom-attributes-for-mouseevent">#initialize-cssom-attributes-for-mouseevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-initialize-cssom-attributes-for-mouseevent">5.3. initialize a MouseEvent</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-cut">
   <b><a href="#handle-native-cut">#handle-native-cut</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-cut">2.4.3. Clipboard</a>
    <li><a href="#ref-for-handle-native-cut①">6.10. handle post browser key</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-copy">
   <b><a href="#handle-native-copy">#handle-native-copy</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-copy">2.4.3. Clipboard</a>
    <li><a href="#ref-for-handle-native-copy①">6.10. handle post browser key</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handle-native-paste">
   <b><a href="#handle-native-paste">#handle-native-paste</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handle-native-paste">2.4.3. Clipboard</a>
    <li><a href="#ref-for-handle-native-paste①">6.10. handle post browser key</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s| )+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>